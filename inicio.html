<!doctype html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Cofre</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
    width: 100%;
    height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: black;
    color: white;
    overflow: hidden;
}

/* ESCONDE TUDO ATÉ CARREGAR */
body {
    visibility: hidden;
}

/* ---------- VINHETA ---------- */
#vignette {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.85) 100%);
    pointer-events: none;
    z-index: 200;
    opacity: 0;
    transition: opacity 2s ease;
}

/* ---------- PRÓLOGO ---------- */
#intro {
    position: fixed;
    inset: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 40px;
    z-index: 100;
}

.intro-text {
    font-size: 1.4rem;
    opacity: 0;
    transition: opacity 1.5s;
    max-width: 600px;
    line-height: 1.6;
}

#start-btn {
    position: absolute;
    bottom: 12%;
    padding: 14px 36px;
    border: 1px solid white;
    background: transparent;
    color: white;
    border-radius: 30px;
    font-size: 1.1rem;
    cursor: pointer;
}

/* ---------- SALA ---------- */
#dark-room {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at center, #111 0%, #000 75%);
    display: none;
    opacity: 0;
    pointer-events: none;
    transition: opacity 2.5s ease;
    z-index: 50;
}

#chest {
    width: 260px;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(1);
    transition: transform 0.8s ease;
    box-shadow: 0 0 40px rgba(255,255,255,0.12);
}

#approach-button {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    padding: 14px 36px;
    border: 1px solid rgba(255,255,255,0.4);
    background: transparent;
    color: white;
    border-radius: 30px;
    font-size: 0.9rem;
    letter-spacing: 3px;
    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1.2s ease;
}

/* ---------- COFRE ---------- */
#vault {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at center, #222 0%, #000 70%);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1.5s ease;
}

.dials {
    display: flex;
    gap: 16px;
}

.dial {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.dial button {
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.6);
    font-size: 1.4rem;
    cursor: pointer;
    padding: 10px;
}

.number {
    font-size: 2.4rem;
    margin: 8px 0;
    transition: transform 0.15s;
}

.number.pop {
    transform: scale(1.2);
}

.hint-container {
    margin-top: 40px;
    text-align: center;
    height: 70px;
}

.hint {
    font-size: 0.9rem;
    color: #aaa;
    opacity: 0.7;
    transition: opacity 0.5s;
}

/* ---------- BOTÃO JORNADA ---------- */
#journey-btn {
    display: none;
    margin-top: 12px;
    padding: 12px 30px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.5);
    color: white;
    border-radius: 25px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-size: 0.75rem;
}

audio { display: none; }
</style>
</head>

<body>

<div id="vignette"></div>

<audio id="ambient" src="ambiente.mp3" loop></audio>
<audio id="sfx-tick" src="tick.mp3"></audio>
<audio id="sfx-response" src="vault-response.mp3"></audio>

<div id="intro">
    <div class="intro-text" id="text"></div>
    <button id="start-btn">Iniciar</button>
</div>

<div id="dark-room">
    <img id="chest" src="cofre.png" alt="Cofre">
    <button id="approach-button">APROXIMAR-SE</button>
</div>

<div id="vault">
    <div class="dials" id="dials"></div>
    <div class="hint-container">
        <div class="hint" id="hint-msg">Talvez nem tudo se abra de primeira.</div>
        <button id="journey-btn" onclick="startJourney()">Voltar ao começo</button>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    document.body.style.visibility = "visible";
    checkIfComingFromEnd();
});

const textEl = document.getElementById("text");
const intro = document.getElementById("intro");
const startBtn = document.getElementById("start-btn");
const darkRoom = document.getElementById("dark-room");
const approachBtn = document.getElementById("approach-button");
const chest = document.getElementById("chest");
const vault = document.getElementById("vault");
const vignette = document.getElementById("vignette");
const hintMsg = document.getElementById("hint-msg");
const journeyBtn = document.getElementById("journey-btn");

const ambient = document.getElementById("ambient");
const sfxTick = document.getElementById("sfx-tick");
const sfxResponse = document.getElementById("sfx-response");

ambient.volume = 0.6;
sfxTick.volume = 0.4;
sfxResponse.volume = 0.8;

// --- LÓGICA NOVA: PULAR INTRO ---
function checkIfComingFromEnd() {
    // Verifica se a URL tem ?acao=abrir
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('acao');

    if (mode === 'abrir') {
        // PULA A INTRODUÇÃO
        intro.style.display = "none";
        
        // MOSTRA A SALA ESCURA IMEDIATAMENTE
        darkRoom.style.display = "block";
        vignette.style.opacity = 1;
        
        setTimeout(() => {
            darkRoom.style.opacity = 1;
            darkRoom.style.pointerEvents = "auto";
            approachBtn.style.opacity = 1;
            approachBtn.style.pointerEvents = "auto";
            // Tenta tocar o áudio (pode ser bloqueado pelo navegador até o primeiro clique, 
            // mas o clique em 'Aproximar' resolve isso depois)
            ambient.play().catch(e => console.log("Aguardando interação para áudio"));
        }, 100);
    }
}

const lines = [
    "Algumas coisas não foram feitas para serem abertas de imediato.",
    "Elas esperam.",
    "Não por tempo...",
    "Mas pela pessoa certa.",
    "Este cofre ficou aqui por muito tempo.",
    "Guardando fragmentos.",
    "Começos.",
    "Lembranças.",
    "Se você está vendo isso agora...",
    "Talvez seja porque chegou a hora de tentar."
];

let index = 0;

function showNextLine() {
    if (index >= lines.length) {
        setTimeout(() => {
            intro.style.opacity = 0;
            setTimeout(() => {
                intro.style.display = "none";
                darkRoom.style.display = "block";
                vignette.style.opacity = 1;
                setTimeout(() => {
                    darkRoom.style.opacity = 1;
                    darkRoom.style.pointerEvents = "auto";
                    setTimeout(() => {
                        approachBtn.style.opacity = 1;
                        approachBtn.style.pointerEvents = "auto";
                    }, 2000);
                }, 50);
            }, 1500);
        }, 2000);
        return;
    }

    textEl.style.opacity = 0;
    setTimeout(() => {
        textEl.innerText = lines[index++];
        textEl.style.opacity = 1;
        setTimeout(showNextLine, 2600);
    }, 800);
}

startBtn.onclick = () => {
    ambient.play();
    startBtn.style.display = "none";
    showNextLine();
};

approachBtn.onclick = () => {
    // Garante que o som toque caso não tenha tocado antes
    if(ambient.paused) ambient.play(); 

    chest.style.transform = "translate(-50%, -50%) scale(1.5)";
    setTimeout(() => {
        darkRoom.style.opacity = 0;
        setTimeout(() => {
            darkRoom.style.display = "none";
            vault.style.display = "flex";
            setTimeout(() => {
                vault.style.opacity = 1;
                vault.style.pointerEvents = "auto";
            }, 50);
        }, 800);
    }, 500);
};

const PASSWORD = [6,9,3,2,1];
const dials = document.getElementById("dials");
let values = [0,0,0,0,0];
let isSolved = false;
let interactionCount = 0;

values.forEach((_, i) => {
    const dial = document.createElement("div");
    dial.className = "dial";

    const up = document.createElement("button");
    up.innerText = "▲";
    up.onclick = () => update(i, 1);

    const num = document.createElement("div");
    num.className = "number";
    num.innerText = "0";

    const down = document.createElement("button");
    down.innerText = "▼";
    down.onclick = () => update(i, -1);

    dial.append(up, num, down);
    dials.appendChild(dial);
    dial.num = num;
});

function update(i, delta) {
    if (isSolved) return;

    values[i] = (values[i] + delta + 10) % 10;
    const numEl = dials.children[i].num;
    numEl.innerText = values[i];

    numEl.classList.remove("pop");
    void numEl.offsetWidth;
    numEl.classList.add("pop");

    sfxTick.currentTime = 0;
    sfxTick.play();

    interactionCount++;
    if (interactionCount === 5 && !isSolved) {
        hintMsg.innerText = "Para abrir o final, talvez seja preciso voltar.";
        journeyBtn.style.display = "inline-block";
    }

    if (values.every((v, idx) => v === PASSWORD[idx])) {
        isSolved = true;
        sfxResponse.play();
        hintMsg.innerText = "O mecanismo respondeu...";
        journeyBtn.style.display = "none";
        
        // AQUI VOCÊ PODE ADICIONAR O QUE ACONTECE QUANDO O COFRE ABRE
        // Exemplo: alert("Parabéns!");
    }
}

function startJourney() {
    window.location.href = "enigma3.html";
}
</script>

</body>
</html>
