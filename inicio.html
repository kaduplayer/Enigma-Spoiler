<!doctype html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Cofre</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    width: 100%;
    height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: black;
    color: white;
    overflow: hidden;
    touch-action: manipulation;
}

/* ---------- VINHETA (bordas escuras) ---------- */
#vignette {
    position: fixed;
    inset: 0;
    background: radial-gradient(
        ellipse at center,
        transparent 20%,
        rgba(0, 0, 0, 0.9) 100%
    );
    opacity: 0;
    pointer-events: none;
    transition: opacity 1.5s ease;
    z-index: 60;
}

/* ---------- PRÓLOGO ---------- */
#intro {
    position: fixed;
    inset: 0;
    background: black;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 30px;
    z-index: 100;
}

.intro-text {
    font-size: 1.3rem;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 1.2s ease, transform 1.2s ease;
    max-width: 600px;
    line-height: 1.8;
    min-height: 80px;
    display: flex;
    align-items: center;
}

#start-btn {
    position: absolute;
    bottom: 15%;
    padding: 16px 42px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    background: transparent;
    color: white;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    letter-spacing: 2px;
    transition: all 0.3s ease;
    min-height: 50px;
    min-width: 50px;
    backdrop-filter: blur(5px);
}

#start-btn:hover,
#start-btn:active {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.6);
    transform: scale(1.05);
}

/* ---------- SALA ESCURA ---------- */
#dark-room {
    position: fixed;
    inset: 0;
    background: #050505;
    display: none;
    opacity: 0;
    pointer-events: none;
    transition: opacity 2s ease;
    z-index: 50;
}

/* ---------- LUZ DA SALA COM FLICKER ---------- */
#room-light {
    position: absolute;
    inset: 0;
    background: radial-gradient(
        circle at center,
        rgba(255, 240, 180, 0.08) 0%,
        rgba(255, 220, 140, 0.05) 25%,
        rgba(100, 80, 40, 0.02) 45%,
        transparent 70%
    );
    opacity: 0;
    transition: opacity 3s ease-in-out;
    z-index: 1;
}

@keyframes light-flicker {
    0%, 100% { opacity: 1; }
    25% { opacity: 0.98; }
    50% { opacity: 0.99; }
    75% { opacity: 0.97; }
}

.light-flickering {
    animation: light-flicker 7s ease-in-out infinite;
}

/* ---------- IMAGEM DO COFRE ---------- */
#chest {
    width: 240px;
    height: auto;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(1);
    transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.5));
    z-index: 2;
    opacity: 0;
    transition: opacity 1.5s ease, transform 1s ease;
}

/* ---------- BOTÃO APROXIMAR ---------- */
#approach-button {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    padding: 16px 40px;
    border: 1px solid rgba(255, 255, 255, 0.25);
    background: rgba(0, 0, 0, 0.2);
    color: rgba(255, 255, 255, 0.85);
    border-radius: 30px;
    font-size: 0.9rem;
    letter-spacing: 3px;
    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s ease;
    backdrop-filter: blur(8px);
    z-index: 3;
    min-height: 48px;
    min-width: 48px;
}

@keyframes pulse-button {
    0%, 100% { 
        opacity: 0.9;
        box-shadow: 0 0 0 rgba(255, 255, 255, 0.1);
    }
    50% { 
        opacity: 1;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
    }
}

.pulse {
    animation: pulse-button 3s ease-in-out infinite;
}

#approach-button:hover,
#approach-button:active {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.5);
    transform: translateX(-50%) scale(1.05);
}

/* ---------- TELA DO COFRE ---------- */
#vault {
    position: fixed;
    inset: 0;
    background: #0a0a0a;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1.5s ease;
    z-index: 80;
}

@keyframes breathing-bg {
    0%, 100% { 
        background-color: #0a0a0a;
    }
    50% { 
        background-color: #111;
    }
}

.breathing {
    animation: breathing-bg 4s ease-in-out infinite;
}

/* ---------- TRANCAS ---------- */
.dials {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
}

.dial {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 70px;
}

.dial button {
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.6rem;
    cursor: pointer;
    padding: 12px 20px;
    transition: all 0.2s ease;
    border-radius: 8px;
    min-height: 50px;
    min-width: 50px;
}

.dial button:active {
    background: rgba(255, 255, 255, 0.05);
    transform: scale(0.95);
}

.number {
    font-size: 2.8rem;
    margin: 12px 0;
    color: #ccc;
    font-weight: 300;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
}

/* Micro-feedback nos números */
.number.zooming {
    transform: scale(1.25);
    color: white;
}

.number.correct-digit {
    color: #d4af37;
    text-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
}

/* Animação do cofre respondendo */
@keyframes chest-response {
    0%, 100% { transform: translate(-50%, -50%) scale(1.45); }
    50% { transform: translate(-50%, -50%) scale(1.48); }
}

.chest-responding {
    animation: chest-response 3s ease-in-out infinite;
}

.hint {
    margin-top: 30px;
    font-size: 0.9rem;
    color: #777;
    letter-spacing: 1px;
    transition: all 0.5s ease;
}

/* ---------- FEEDBACK FINAL ---------- */
#feedback {
    position: absolute;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1rem;
    color: #d4af37;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1s ease;
    text-align: center;
    width: 80%;
    max-width: 400px;
}

audio {
    display: none;
}

/* ---------- RESPONSIVO ---------- */
@media (max-width: 768px) {
    .intro-text {
        font-size: 1.1rem;
        padding: 0 20px;
    }
    
    #start-btn {
        padding: 14px 36px;
        font-size: 0.95rem;
        bottom: 20%;
    }
    
    .dials {
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .dial {
        min-width: 60px;
    }
    
    .number {
        font-size: 2.2rem;
    }
    
    .dial button {
        font-size: 1.4rem;
        padding: 10px 16px;
    }
    
    #chest {
        width: 200px;
    }
    
    #approach-button {
        bottom: 70px;
        padding: 14px 36px;
        font-size: 0.85rem;
    }
}
</style>
</head>
<body>
<!-- ÁUDIOS -->
<audio id="ambient" src="ambiente.mp3" loop></audio>
<audio id="tick-sound" src="tick.mp3" preload="auto"></audio>
<audio id="correct-sound" src="lock-correct.mp3" preload="auto"></audio>
<audio id="vault-sound" src="vault-response.mp3" preload="auto"></audio>

<!-- VINHETA -->
<div id="vignette"></div>

<!-- PRÓLOGO -->
<div id="intro">
    <div class="intro-text" id="text"></div>
    <button id="start-btn">Iniciar</button>
</div>

<!-- SALA -->
<div id="dark-room">
    <!-- Luz da sala -->
    <div id="room-light"></div>
    
    <!-- Imagem do cofre -->
    <img id="chest" src="cofre.png" alt="Cofre">
    
    <!-- Botão de aproximação -->
    <button id="approach-button" class="pulse">APROXIMAR-SE</button>
</div>

<!-- COFRE -->
<div id="vault">
    <div class="dials" id="dials"></div>
    <div class="hint">Talvez nem tudo se abra de primeira.</div>
    <div id="feedback"></div>
</div>

<script>
// Elementos DOM
const vignette = document.getElementById("vignette");
const textEl = document.getElementById("text");
const intro = document.getElementById("intro");
const startBtn = document.getElementById("start-btn");
const darkRoom = document.getElementById("dark-room");
const roomLight = document.getElementById("room-light");
const approachBtn = document.getElementById("approach-button");
const chest = document.getElementById("chest");
const vault = document.getElementById("vault");
const dials = document.getElementById("dials");
const feedback = document.getElementById("feedback");

// Áudios
const ambient = document.getElementById("ambient");
const tickSound = document.getElementById("tick-sound");
const correctSound = document.getElementById("correct-sound");
const vaultSound = document.getElementById("vault-sound");

// Configurar volumes
tickSound.volume = 0.3;
correctSound.volume = 0.4;
vaultSound.volume = 0.5;

// Senha e estado
const PASSWORD = [6, 1, 4, 2, 9];
let values = [0, 0, 0, 0, 0];
let correctDigits = [false, false, false, false, false];
let allCorrect = false;

// Textos do prólogo
const lines = [
    "Algumas coisas não foram feitas para serem abertas de imediato.",
    "Elas esperam.",
    "Não por tempo...",
    "Mas pela pessoa certa.",
    "Este cofre ficou aqui por muito tempo.",
    "Guardando fragmentos.",
    "Começos.",
    "Lembranças.",
    "Se você está vendo isso agora...",
    "Talvez seja porque chegou a hora de tentar."
];

let index = 0;

// Função para tocar som com segurança
function playSound(audioElement) {
    audioElement.currentTime = 0;
    audioElement.play().catch(e => console.log("Som não pôde ser tocado"));
}

// Mostrar prólogo frase por frase
function showNextLine() {
    if (index >= lines.length) {
        // Fim do prólogo
        setTimeout(() => {
            intro.style.opacity = 0;
            setTimeout(() => {
                intro.style.display = "none";

                // Mostrar sala escura
                darkRoom.style.display = "block";
                setTimeout(() => {
                    darkRoom.style.opacity = 1;
                    darkRoom.style.pointerEvents = "auto";
                    
                    // Ativar vinheta
                    vignette.style.opacity = 0.8;
                    
                    // Acender luz gradualmente
                    setTimeout(() => {
                        roomLight.style.opacity = 1;
                        roomLight.classList.add("light-flickering");
                        
                        // Mostrar cofre
                        setTimeout(() => {
                            chest.style.opacity = 1;
                        }, 500);
                        
                        // Mostrar botão de aproximação
                        setTimeout(() => {
                            approachBtn.style.opacity = 1;
                            approachBtn.style.pointerEvents = "auto";
                        }, 1500);
                    }, 300);
                }, 50);
            }, 1500);
        }, 2000);
        return;
    }

    // Esconder texto atual
    textEl.style.opacity = 0;
    textEl.style.transform = "translateY(-10px)";
    
    setTimeout(() => {
        // Mostrar nova frase
        textEl.innerText = lines[index];
        textEl.style.opacity = 1;
        textEl.style.transform = "translateY(0)";
        index++;
        
        // Chamar próxima frase
        setTimeout(showNextLine, 2800);
    }, 800);
}

// Iniciar experiência
startBtn.onclick = () => {
    // Fade in do som ambiente
    ambient.volume = 0;
    ambient.play();
    let v = 0;
    const fade = setInterval(() => {
        v += 0.02;
        ambient.volume = Math.min(v, 0.5);
        if (v >= 0.5) clearInterval(fade);
    }, 100);

    startBtn.style.display = "none";
    showNextLine();
};

// Aproximação do cofre
approachBtn.onclick = () => {
    // Zoom no cofre
    chest.style.transform = "translate(-50%, -50%) scale(1.45)";
    
    // Esconder botão
    approachBtn.style.opacity = 0;
    approachBtn.style.pointerEvents = "none";

    setTimeout(() => {
        // Transição para tela do cofre
        darkRoom.style.opacity = 0;
        darkRoom.style.pointerEvents = "none";

        setTimeout(() => {
            darkRoom.style.display = "none";
            
            // Ajustar vinheta
            vignette.style.opacity = 0.9;
            
            // Mostrar tela do cofre
            vault.style.display = "flex";
            setTimeout(() => {
                vault.style.opacity = 1;
                vault.style.pointerEvents = "auto";
                
                // Criar trancas
                createDials();
            }, 100);
        }, 800);
    }, 600);
};

// Criar trancas (dígitos)
function createDials() {
    dials.innerHTML = "";
    
    values.forEach((_, i) => {
        const dial = document.createElement("div");
        dial.className = "dial";
        dial.id = `dial-${i}`;

        // Botão para cima
        const up = document.createElement("button");
        up.innerText = "▲";
        up.addEventListener("click", () => updateDial(i, 1));
        up.addEventListener("touchstart", (e) => {
            e.preventDefault();
            updateDial(i, 1);
        });

        // Número
        const num = document.createElement("div");
        num.className = "number";
        num.id = `number-${i}`;
        num.innerText = "0";

        // Botão para baixo
        const down = document.createElement("button");
        down.innerText = "▼";
        down.addEventListener("click", () => updateDial(i, -1));
        down.addEventListener("touchstart", (e) => {
            e.preventDefault();
            updateDial(i, -1);
        });

        dial.appendChild(up);
        dial.appendChild(num);
        dial.appendChild(down);
        dials.appendChild(dial);

        // Salvar referência
        dial.num = num;
    });
}

// Atualizar dígito
function updateDial(i, delta) {
    // Tocar som do giro
    playSound(tickSound);
    
    // Atualizar valor
    values[i] = (values[i] + delta + 10) % 10;
    
    // Atualizar display
    const numElement = document.getElementById(`number-${i}`);
    numElement.innerText = values[i];
    
    // Animação de zoom
    numElement.classList.add("zooming");
    setTimeout(() => {
        numElement.classList.remove("zooming");
    }, 300);
    
    // Verificar senha
    checkPassword();
}

// Verificar senha completa
function checkPassword() {
    // Verificar cada dígito
    let newCorrectDigits = values.map((v, idx) => v === PASSWORD[idx]);
    let changedDigits = [];
    
    // Encontrar dígitos que acabaram de ficar corretos
    newCorrectDigits.forEach((isCorrect, i) => {
        if (isCorrect && !correctDigits[i]) {
            changedDigits.push(i);
        }
    });
    
    // Atualizar estado
    correctDigits = newCorrectDigits;
    
    // Tocar som para dígitos que acabaram de ficar corretos
    if (changedDigits.length > 0) {
        playSound(correctSound);
        
        // Marcar dígitos corretos visualmente
        changedDigits.forEach(i => {
            const numElement = document.getElementById(`number-${i}`);
            numElement.classList.add("correct-digit");
        });
    }
    
    // Verificar se TODOS estão corretos
    const allCorrectNow = correctDigits.every(c => c);
    
    if (allCorrectNow && !allCorrect) {
        // PRIMEIRA VEZ que a senha está completa
        allCorrect = true;
        
        // Tocar som do cofre respondendo
        setTimeout(() => playSound(vaultSound), 400);
        
        // Mostrar feedback
        feedback.textContent = "O cofre respondeu...";
        feedback.style.opacity = 1;
        
        // Animação de respiração no fundo
        vault.classList.add("breathing");
        
        // Suavizar vinheta
        vignette.style.opacity = 0.4;
        vignette.style.transition = "opacity 2s ease";
        
        // Animar cofre (se estivesse visível)
        if (chest) {
            chest.classList.add("chest-responding");
        }
        
        // Atualizar hint
        document.querySelector(".hint").textContent = "Algo se moveu dentro do cofre...";
        document.querySelector(".hint").style.color = "#d4af37";
        
    } else if (!allCorrectNow && allCorrect) {
        // Senha deixou de estar correta
        allCorrect = false;
        feedback.style.opacity = 0;
        vault.classList.remove("breathing");
        vignette.style.opacity = 0.9;
        
        if (chest) {
            chest.classList.remove("chest-responding");
        }
        
        // Remover marcação dos dígitos corretos
        correctDigits.forEach((isCorrect, i) => {
            if (!isCorrect) {
                const numElement = document.getElementById(`number-${i}`);
                numElement.classList.remove("correct-digit");
            }
        });
    }
}

// Inicializar
createDials();
</script>
</body>
</html>