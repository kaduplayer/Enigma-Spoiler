<!doctype html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Cofre</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

html,body{
    width:100%;
    height:100%;
    font-family:'Montserrat',sans-serif;
    background:black;
    color:white;
    overflow:hidden;
}

/* ---------- VINHETA ---------- */
.vignette{
    position:fixed;
    inset:0;
    pointer-events:none;
    background:radial-gradient(circle, rgba(0,0,0,0) 55%, rgba(0,0,0,0.65) 100%);
    opacity:0;
    transition:opacity 2s ease;
    z-index:90;
}

/* ---------- PRÓLOGO ---------- */
#intro{
    position:fixed;
    inset:0;
    background:black;
    display:flex;
    justify-content:center;
    align-items:center;
    text-align:center;
    padding:40px;
    z-index:100;
}

.intro-text{
    font-size:1.4rem;
    opacity:0;
    transition:opacity 1.5s;
    max-width:600px;
    line-height:1.6;
}

#start-btn{
    position:absolute;
    bottom:12%;
    padding:14px 36px;
    border:1px solid white;
    background:transparent;
    color:white;
    border-radius:30px;
    font-size:1.1rem;
    cursor:pointer;
}

/* ---------- SALA ---------- */
#dark-room{
    position:fixed;
    inset:0;
    background:radial-gradient(circle at center, #111 0%, #000 75%);
    display:none;
    opacity:0;
    pointer-events:none;
    transition:opacity 2.5s ease;
    z-index:50;
    animation:flicker 9s infinite;
}

@keyframes flicker{
    0%,100%{opacity:1}
    50%{opacity:0.97}
}

/* ---------- COFRE ---------- */
#chest{
    width:260px;
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%) scale(1);
    transition:transform 0.6s ease;
    box-shadow:0 0 40px rgba(255,255,255,0.12);
}

#approach-button{
    position:absolute;
    bottom:80px;
    left:50%;
    transform:translateX(-50%);
    padding:14px 36px;
    border:1px solid rgba(255,255,255,0.4);
    background:transparent;
    color:white;
    border-radius:30px;
    font-size:0.9rem;
    letter-spacing:3px;
    cursor:pointer;
    opacity:0;
    pointer-events:none;
    transition:opacity 1.2s ease;
}

/* ---------- TELA DO COFRE ---------- */
#vault{
    position:fixed;
    inset:0;
    background:radial-gradient(circle at center, #222 0%, #000 70%);
    display:none;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    opacity:0;
    pointer-events:none;
    transition:opacity 1.5s ease;
}

/* ---------- TRANCAS ---------- */
.dials{display:flex;gap:16px}

.dial{display:flex;flex-direction:column;align-items:center}

.dial button{
    background:transparent;
    border:none;
    color:white;
    font-size:1.4rem;
    cursor:pointer;
}

.number{
    font-size:2.4rem;
    margin:8px 0;
    transition:transform 0.2s ease,color 0.3s ease;
}

.correct{color:#eee}

.hint{
    margin-top:30px;
    font-size:0.9rem;
    color:#aaa;
}

audio{display:none}

/* ---------- RESPIRA ---------- */
@keyframes pulse{
    0%,100%{background-size:100% 100%}
    50%{background-size:110% 110%}
}
</style>
</head>

<body>

<!-- ÁUDIOS -->
<audio id="ambient" src="ambiente.mp3" loop></audio>
<audio id="tick" src="tick.mp3"></audio>
<audio id="lock" src="lock-correct.mp3"></audio>
<audio id="vaultSound" src="vault-response.mp3"></audio>

<div class="vignette" id="vignette"></div>

<!-- PRÓLOGO -->
<div id="intro">
    <div class="intro-text" id="text"></div>
    <button id="start-btn">Iniciar</button>
</div>

<!-- SALA -->
<div id="dark-room">
    <img id="chest" src="cofre.png" alt="Cofre">
    <button id="approach-button">APROXIMAR-SE</button>
</div>

<!-- COFRE -->
<div id="vault">
    <div class="dials" id="dials"></div>
    <div class="hint">Talvez nem tudo se abra de primeira.</div>
</div>

<script>
const textEl=document.getElementById("text");
const intro=document.getElementById("intro");
const startBtn=document.getElementById("start-btn");
const darkRoom=document.getElementById("dark-room");
const approachBtn=document.getElementById("approach-button");
const chest=document.getElementById("chest");
const vault=document.getElementById("vault");
const ambient=document.getElementById("ambient");
const vignette=document.getElementById("vignette");

const tick=document.getElementById("tick");
const lock=document.getElementById("lock");
const vaultSound=document.getElementById("vaultSound");

const lines=[
 "Algumas coisas não foram feitas para serem abertas de imediato.",
 "Elas esperam.",
 "Não por tempo...",
 "Mas pela pessoa certa.",
 "Este cofre ficou aqui por muito tempo.",
 "Guardando fragmentos.",
 "Começos.",
 "Lembranças.",
 "Se você está vendo isso agora...",
 "Talvez seja porque chegou a hora de tentar."
];

let index=0;

function showNextLine(){
 if(index>=lines.length){
  setTimeout(()=>{
   intro.style.opacity=0;
   setTimeout(()=>{
    intro.style.display="none";
    darkRoom.style.display="block";
    vignette.style.opacity=1;
    setTimeout(()=>{
     darkRoom.style.opacity=1;
     darkRoom.style.pointerEvents="auto";
     setTimeout(()=>{
      approachBtn.style.opacity=1;
      approachBtn.style.pointerEvents="auto";
     },2000);
    },50);
   },1500);
  },2000);
  return;
 }
 textEl.style.opacity=0;
 setTimeout(()=>{
  textEl.innerText=lines[index++];
  textEl.style.opacity=1;
  setTimeout(showNextLine,2600);
 },800);
}

/* ---------- MOBILE SAFE ---------- */
startBtn.onclick=()=>{
 startBtn.style.display="none";
 showNextLine();

 try{
  ambient.volume=0;
  const p=ambient.play();
  if(p!==undefined){
   p.then(()=>{
    let v=0;
    const fade=setInterval(()=>{
     v+=0.02;
     ambient.volume=Math.min(v,0.6);
     if(v>=0.6) clearInterval(fade);
    },100);
   });
  }
 }catch(e){}
};

/* ---------- APROXIMAR ---------- */
approachBtn.onclick=()=>{
 chest.style.transform="translate(-50%,-50%) scale(1.45)";
 setTimeout(()=>{
  darkRoom.style.opacity=0;
  setTimeout(()=>{
   darkRoom.style.display="none";
   vault.style.display="flex";
   setTimeout(()=>{
    vault.style.opacity=1;
    vault.style.pointerEvents="auto";
   },50);
  },800);
 },500);
};

/* ---------- TRAVA ---------- */
const PASSWORD=[6,1,4,2,9];
const dials=document.getElementById("dials");
let values=[0,0,0,0,0];
let solved=false;

values.forEach((_,i)=>{
 const dial=document.createElement("div");
 dial.className="dial";

 const up=document.createElement("button");
 up.innerText="▲";
 up.onclick=()=>update(i,1);

 const num=document.createElement("div");
 num.className="number";
 num.innerText="0";

 const down=document.createElement("button");
 down.innerText="▼";
 down.onclick=()=>update(i,-1);

 dial.append(up,num,down);
 dials.appendChild(dial);
 dial.num=num;
});

function update(i,delta){
 if(solved) return;

 tick.currentTime=0;
 tick.play();

 values[i]=(values[i]+delta+10)%10;
 const numEl=dials.children[i].num;
 numEl.innerText=values[i];

 numEl.style.transform="scale(1.05)";
 setTimeout(()=>numEl.style.transform="scale(1)",150);

 if(values[i]===PASSWORD[i]){
  numEl.classList.add("correct");
  lock.currentTime=0;
  lock.play();
 }else{
  numEl.classList.remove("correct");
 }

 if(values.every((v,idx)=>v===PASSWORD[idx])){
  solved=true;
  vaultSound.play();
  vault.style.animation="pulse 3s ease infinite";
  vignette.style.opacity=0.4;
 }
}
</script>

</body>
</html>
nd-size:110% 110%}
}`;
document.head.appendChild(style);
</script>

</body>
</html>
nette"></div>

<!-- PRÓLOGO -->
<div id="intro">
    <div class="intro-text" id="text"></div>
    <button id="start-btn">Iniciar</button>
</div>

<!-- SALA -->
<div id="dark-room">
    <!-- Luz da sala -->
    <div id="room-light"></div>
    
    <!-- Imagem do cofre -->
    <img id="chest" src="cofre.png" alt="Cofre">
    
    <!-- Botão de aproximação -->
    <button id="approach-button" class="pulse">APROXIMAR-SE</button>
</div>

<!-- COFRE -->
<div id="vault">
    <div class="dials" id="dials"></div>
    <div class="hint">Talvez nem tudo se abra de primeira.</div>
    <div id="feedback"></div>
</div>

<script>
// Elementos DOM
const vignette = document.getElementById("vignette");
const textEl = document.getElementById("text");
const intro = document.getElementById("intro");
const startBtn = document.getElementById("start-btn");
const darkRoom = document.getElementById("dark-room");
const roomLight = document.getElementById("room-light");
const approachBtn = document.getElementById("approach-button");
const chest = document.getElementById("chest");
const vault = document.getElementById("vault");
const dials = document.getElementById("dials");
const feedback = document.getElementById("feedback");

// Áudios
const ambient = document.getElementById("ambient");
const tickSound = document.getElementById("tick-sound");
const correctSound = document.getElementById("correct-sound");
const vaultSound = document.getElementById("vault-sound");

// Configurar volumes
tickSound.volume = 0.3;
correctSound.volume = 0.4;
vaultSound.volume = 0.5;

// Senha e estado
const PASSWORD = [6, 1, 4, 2, 9];
let values = [0, 0, 0, 0, 0];
let correctDigits = [false, false, false, false, false];
let allCorrect = false;

// Textos do prólogo
const lines = [
    "Algumas coisas não foram feitas para serem abertas de imediato.",
    "Elas esperam.",
    "Não por tempo...",
    "Mas pela pessoa certa.",
    "Este cofre ficou aqui por muito tempo.",
    "Guardando fragmentos.",
    "Começos.",
    "Lembranças.",
    "Se você está vendo isso agora...",
    "Talvez seja porque chegou a hora de tentar."
];

let index = 0;

// Função para tocar som com segurança
function playSound(audioElement) {
    audioElement.currentTime = 0;
    audioElement.play().catch(e => console.log("Som não pôde ser tocado"));
}

// Mostrar prólogo frase por frase
function showNextLine() {
    if (index >= lines.length) {
        // Fim do prólogo
        setTimeout(() => {
            intro.style.opacity = 0;
            setTimeout(() => {
                intro.style.display = "none";

                // Mostrar sala escura
                darkRoom.style.display = "block";
                setTimeout(() => {
                    darkRoom.style.opacity = 1;
                    darkRoom.style.pointerEvents = "auto";
                    
                    // Ativar vinheta
                    vignette.style.opacity = 0.8;
                    
                    // Acender luz gradualmente
                    setTimeout(() => {
                        roomLight.style.opacity = 1;
                        roomLight.classList.add("light-flickering");
                        
                        // Mostrar cofre
                        setTimeout(() => {
                            chest.style.opacity = 1;
                        }, 500);
                        
                        // Mostrar botão de aproximação
                        setTimeout(() => {
                            approachBtn.style.opacity = 1;
                            approachBtn.style.pointerEvents = "auto";
                        }, 1500);
                    }, 300);
                }, 50);
            }, 1500);
        }, 2000);
        return;
    }

    // Esconder texto atual
    textEl.style.opacity = 0;
    textEl.style.transform = "translateY(-10px)";
    
    setTimeout(() => {
        // Mostrar nova frase
        textEl.innerText = lines[index];
        textEl.style.opacity = 1;
        textEl.style.transform = "translateY(0)";
        index++;
        
        // Chamar próxima frase
        setTimeout(showNextLine, 2800);
    }, 800);
}

// Iniciar experiência
startBtn.onclick = () => {
    // Fade in do som ambiente
    ambient.volume = 0;
    ambient.play();
    let v = 0;
    const fade = setInterval(() => {
        v += 0.02;
        ambient.volume = Math.min(v, 0.5);
        if (v >= 0.5) clearInterval(fade);
    }, 100);

    startBtn.style.display = "none";
    showNextLine();
};

// Aproximação do cofre
approachBtn.onclick = () => {
    // Zoom no cofre
    chest.style.transform = "translate(-50%, -50%) scale(1.45)";
    
    // Esconder botão
    approachBtn.style.opacity = 0;
    approachBtn.style.pointerEvents = "none";

    setTimeout(() => {
        // Transição para tela do cofre
        darkRoom.style.opacity = 0;
        darkRoom.style.pointerEvents = "none";

        setTimeout(() => {
            darkRoom.style.display = "none";
            
            // Ajustar vinheta
            vignette.style.opacity = 0.9;
            
            // Mostrar tela do cofre
            vault.style.display = "flex";
            setTimeout(() => {
                vault.style.opacity = 1;
                vault.style.pointerEvents = "auto";
                
                // Criar trancas
                createDials();
            }, 100);
        }, 800);
    }, 600);
};

// Criar trancas (dígitos)
function createDials() {
    dials.innerHTML = "";
    
    values.forEach((_, i) => {
        const dial = document.createElement("div");
        dial.className = "dial";
        dial.id = `dial-${i}`;

        // Botão para cima
        const up = document.createElement("button");
        up.innerText = "▲";
        up.addEventListener("click", () => updateDial(i, 1));
        up.addEventListener("touchstart", (e) => {
            e.preventDefault();
            updateDial(i, 1);
        });

        // Número
        const num = document.createElement("div");
        num.className = "number";
        num.id = `number-${i}`;
        num.innerText = "0";

        // Botão para baixo
        const down = document.createElement("button");
        down.innerText = "▼";
        down.addEventListener("click", () => updateDial(i, -1));
        down.addEventListener("touchstart", (e) => {
            e.preventDefault();
            updateDial(i, -1);
        });

        dial.appendChild(up);
        dial.appendChild(num);
        dial.appendChild(down);
        dials.appendChild(dial);

        // Salvar referência
        dial.num = num;
    });
}

// Atualizar dígito
function updateDial(i, delta) {
    // Tocar som do giro
    playSound(tickSound);
    
    // Atualizar valor
    values[i] = (values[i] + delta + 10) % 10;
    
    // Atualizar display
    const numElement = document.getElementById(`number-${i}`);
    numElement.innerText = values[i];
    
    // Animação de zoom
    numElement.classList.add("zooming");
    setTimeout(() => {
        numElement.classList.remove("zooming");
    }, 300);
    
    // Verificar senha
    checkPassword();
}

// Verificar senha completa
function checkPassword() {
    // Verificar cada dígito
    let newCorrectDigits = values.map((v, idx) => v === PASSWORD[idx]);
    let changedDigits = [];
    
    // Encontrar dígitos que acabaram de ficar corretos
    newCorrectDigits.forEach((isCorrect, i) => {
        if (isCorrect && !correctDigits[i]) {
            changedDigits.push(i);
        }
    });
    
    // Atualizar estado
    correctDigits = newCorrectDigits;
    
    // Tocar som para dígitos que acabaram de ficar corretos
    if (changedDigits.length > 0) {
        playSound(correctSound);
        
        // Marcar dígitos corretos visualmente
        changedDigits.forEach(i => {
            const numElement = document.getElementById(`number-${i}`);
            numElement.classList.add("correct-digit");
        });
    }
    
    // Verificar se TODOS estão corretos
    const allCorrectNow = correctDigits.every(c => c);
    
    if (allCorrectNow && !allCorrect) {
        // PRIMEIRA VEZ que a senha está completa
        allCorrect = true;
        
        // Tocar som do cofre respondendo
        setTimeout(() => playSound(vaultSound), 400);
        
        // Mostrar feedback
        feedback.textContent = "O cofre respondeu...";
        feedback.style.opacity = 1;
        
        // Animação de respiração no fundo
        vault.classList.add("breathing");
        
        // Suavizar vinheta
        vignette.style.opacity = 0.4;
        vignette.style.transition = "opacity 2s ease";
        
        // Animar cofre (se estivesse visível)
        if (chest) {
            chest.classList.add("chest-responding");
        }
        
        // Atualizar hint
        document.querySelector(".hint").textContent = "Algo se moveu dentro do cofre...";
        document.querySelector(".hint").style.color = "#d4af37";
        
    } else if (!allCorrectNow && allCorrect) {
        // Senha deixou de estar correta
        allCorrect = false;
        feedback.style.opacity = 0;
        vault.classList.remove("breathing");
        vignette.style.opacity = 0.9;
        
        if (chest) {
            chest.classList.remove("chest-responding");
        }
        
        // Remover marcação dos dígitos corretos
        correctDigits.forEach((isCorrect, i) => {
            if (!isCorrect) {
                const numElement = document.getElementById(`number-${i}`);
                numElement.classList.remove("correct-digit");
            }
        });
    }
}

// Inicializar
createDials();
</script>
</body>
</html>