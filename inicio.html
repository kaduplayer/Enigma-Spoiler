<!doctype html>
<html lang="pt-br">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>O Cofre</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
        width: 100%; height: 100%;
        font-family: 'Montserrat', sans-serif;
        background: black; color: white; overflow: hidden;
    }

    /* ---------- VINHETA ---------- */
    #vignette {
        position: fixed; inset: 0;
        background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 100%);
        pointer-events: none; z-index: 200; opacity: 0; transition: opacity 2s ease;
    }

    /* ---------- PRÓLOGO ---------- */
    #intro {
        position: fixed; inset: 0; background: black;
        display: flex; justify-content: center; align-items: center;
        text-align: center; padding: 40px; z-index: 100;
    }

    .intro-text {
        font-size: 1.4rem; opacity: 0; transition: opacity 1.5s;
        max-width: 600px; line-height: 1.6;
    }

    #start-btn {
        position: absolute; bottom: 12%; padding: 14px 36px;
        border: 1px solid white; background: transparent; color: white;
        border-radius: 30px; font-size: 1.1rem; cursor: pointer;
    }

    /* ---------- SALA ESCURA ---------- */
    #dark-room {
        position: fixed; inset: 0;
        background: radial-gradient(circle at center, #111 0%, #000 75%);
        display: none; opacity: 0; pointer-events: none;
        transition: opacity 2.5s ease; z-index: 50;
    }

    @keyframes flicker {
        0% { opacity: 1; } 3% { opacity: 0.95; } 6% { opacity: 1; }
        7% { opacity: 0.9; } 8% { opacity: 1; } 9% { opacity: 1; }
        10% { opacity: 0.92; } 11% { opacity: 1; } 100% { opacity: 1; }
    }

    #chest {
        width: 260px; height: auto; position: absolute;
        left: 50%; top: 50%; transform: translate(-50%, -50%) scale(1);
        transition: transform 0.6s ease;
        box-shadow: 0 0 40px rgba(255,255,255,0.12);
    }

    #approach-button {
        position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
        padding: 14px 36px; border: 1px solid rgba(255,255,255,0.4);
        background: transparent; color: white; border-radius: 30px;
        font-size: 0.9rem; letter-spacing: 3px; cursor: pointer;
        opacity: 0; pointer-events: none; transition: opacity 1.2s ease;
    }

    /* ---------- TELA DO COFRE ---------- */
    #vault {
        position: fixed; inset: 0;
        background: radial-gradient(circle at center, #222 0%, #000 70%);
        display: none; flex-direction: column; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 1.5s ease;
        animation: flicker 4s infinite;
    }

    @keyframes breathe {
        0% { background: radial-gradient(circle at center, #222 0%, #000 70%); }
        50% { background: radial-gradient(circle at center, #333 0%, #111 60%); }
        100% { background: radial-gradient(circle at center, #222 0%, #000 70%); }
    }

    #vault.solved { animation: breathe 3s infinite ease-in-out; }

    .dials { display: flex; gap: 16px; }
    .dial { display: flex; flex-direction: column; align-items: center; }
    
    .dial button {
        background: transparent; border: none; color: rgba(255,255,255,0.5);
        font-size: 1.4rem; cursor: pointer; transition: color 0.3s; padding: 10px;
    }
    .dial button:active { color: white; }

    .number {
        font-size: 2.4rem; margin: 8px 0;
        transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275), color 0.3s, text-shadow 0.3s;
    }

    .number.pop { transform: scale(1.2); }
    .number.correct-digit { color: #fff; text-shadow: 0 0 15px rgba(255, 255, 255, 0.6); }

    .hint-container {
        margin-top: 40px; text-align: center; height: 60px; /* Altura fixa para não pular */
    }

    .hint { font-size: 0.9rem; color: #aaa; opacity: 0.7; transition: opacity 0.5s; }

    /* Botão da Jornada (Gatilho) */
    #journey-btn {
        display: none; /* Começa oculto */
        margin-top: 10px;
        padding: 12px 30px;
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.5);
        color: white;
        border-radius: 25px;
        cursor: pointer;
        font-family: 'Montserrat', sans-serif;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-size: 0.8rem;
        animation: glowButton 2s infinite alternate;
    }

    @keyframes glowButton {
        from { box-shadow: 0 0 5px rgba(255,255,255,0.1); }
        to { box-shadow: 0 0 20px rgba(255,255,255,0.4); }
    }

    audio { display: none; }
  </style>
 </head>
 <body>
  
  <div id="vignette"></div>

  <audio id="ambient" src="ambiente.mp3" loop></audio>
  <audio id="sfx-tick" src="tick.mp3"></audio>
  <audio id="sfx-lock" src="lock-correct.mp3"></audio>
  <audio id="sfx-response" src="vault-response.mp3"></audio>

  <div id="intro">
   <div class="intro-text" id="text"></div>
   <button id="start-btn">Iniciar</button>
  </div>

  <div id="dark-room">
   <img id="chest" src="cofre.png" alt="Cofre">
   <button id="approach-button">APROXIMAR-SE</button>
  </div>

  <div id="vault">
   <div class="dials" id="dials"></div>
   
   <div class="hint-container">
       <div class="hint" id="hint-msg">Talvez nem tudo se abra de primeira.</div>
       <button id="journey-btn" onclick="startJourney()">Voltar ao começo</button>
   </div>
  </div>

<script>
const textEl = document.getElementById("text");
const intro = document.getElementById("intro");
const startBtn = document.getElementById("start-btn");
const darkRoom = document.getElementById("dark-room");
const approachBtn = document.getElementById("approach-button");
const chest = document.getElementById("chest");
const vault = document.getElementById("vault");
const vignette = document.getElementById("vignette");
const hintMsg = document.getElementById("hint-msg");
const journeyBtn = document.getElementById("journey-btn");

// Áudios
const ambient = document.getElementById("ambient");
const sfxTick = document.getElementById("sfx-tick");
const sfxLock = document.getElementById("sfx-lock");
const sfxResponse = document.getElementById("sfx-response");

sfxTick.volume = 0.4;
sfxLock.volume = 0.6;
sfxResponse.volume = 0.8;

// --- CONFIGURAÇÃO DA NARRATIVA ---
const lines = [
    "Algumas coisas não foram feitas para serem abertas de imediato.",
    "Elas esperam.",
    "Não por tempo...",
    "Mas pela pessoa certa.",
    "Este cofre ficou aqui por muito tempo.",
    "Guardando fragmentos.",
    "Começos.",
    "Lembranças.",
    "Se você está vendo isso agora...",
    "Talvez seja porque chegou a hora de tentar."
];

let index = 0;

function showNextLine() {
    if (index >= lines.length) {
        setTimeout(() => {
            intro.style.opacity = 0;
            setTimeout(() => {
                intro.style.display = "none";
                darkRoom.style.display = "block";
                vignette.style.opacity = 1;

                setTimeout(() => {
                    darkRoom.style.opacity = 1;
                    darkRoom.style.pointerEvents = "auto";
                    setTimeout(() => {
                        approachBtn.style.opacity = 1;
                        approachBtn.style.pointerEvents = "auto";
                    }, 2000);
                }, 50);
            }, 1500);
        }, 2000);
        return;
    }
    textEl.style.opacity = 0;
    setTimeout(() => {
        textEl.innerText = lines[index];
        textEl.style.opacity = 1;
        index++;
        setTimeout(showNextLine, 2600);
    }, 800);
}

startBtn.onclick = () => {
    ambient.volume = 0;
    ambient.play();
    let v = 0;
    const fade = setInterval(() => {
        v += 0.02;
        ambient.volume = Math.min(v, 0.6);
        if (v >= 0.6) clearInterval(fade);
    }, 100);

    startBtn.style.display = "none";
    showNextLine();
};

approachBtn.onclick = () => {
    chest.style.transform = "translate(-50%, -50%) scale(1.45)";
    vignette.style.opacity = 0.6; 

    setTimeout(() => {
        darkRoom.style.opacity = 0;
        darkRoom.style.pointerEvents = "none";
        setTimeout(() => {
            darkRoom.style.display = "none";
            vault.style.display = "flex";
            setTimeout(() => {
                vault.style.opacity = 1;
                vault.style.pointerEvents = "auto";
                vignette.style.opacity = 1;
            }, 50);
        }, 800);
    }, 500);
};

/* ---------- TRAVA & LÓGICA ---------- */
const PASSWORD = [6,1,4,2,9];
const dials = document.getElementById("dials");
let values = [0,0,0,0,0];
let isSolved = false;

// Contador de tentativas para liberar a jornada
let interactionCount = 0;
const INTERACTION_LIMIT = 5; // Aparece após 5 cliques

values.forEach((_, i) => {
    const dial = document.createElement("div");
    dial.className = "dial";

    const up = document.createElement("button");
    up.innerText = "▲";
    up.onclick = () => update(i, 1);

    const num = document.createElement("div");
    num.className = "number";
    num.innerText = "0";

    const down = document.createElement("button");
    down.innerText = "▼";
    down.onclick = () => update(i, -1);

    dial.appendChild(up);
    dial.appendChild(num);
    dial.appendChild(down);
    dials.appendChild(dial);

    dial.num = num;
});

function update(i, delta) {
    if (isSolved) return;

    // Atualiza número
    values[i] = (values[i] + delta + 10) % 10;
    const numEl = dials.children[i].num;
    numEl.innerText = values[i];

    // Efeitos
    numEl.classList.remove("pop");
    void numEl.offsetWidth; 
    numEl.classList.add("pop");

    if (values[i] === PASSWORD[i]) {
        sfxLock.currentTime = 0;
        sfxLock.play();
        numEl.classList.add("correct-digit");
    } else {
        sfxTick.currentTime = 0;
        sfxTick.play();
        numEl.classList.remove("correct-digit");
    }

    // --- LÓGICA DA JORNADA ---
    interactionCount++;
    if (interactionCount === INTERACTION_LIMIT && !isSolved) {
        revealJourney();
    }

    // Verifica Vitória
    if (values.every((v, idx) => v === PASSWORD[idx])) {
        isSolved = true;
        onSuccess();
    }
}

function revealJourney() {
    hintMsg.style.opacity = 0;
    setTimeout(() => {
        hintMsg.innerText = "Para abrir o final, você precisa voltar ao começo.";
        hintMsg.style.opacity = 1;
        
        // Faz o botão aparecer suavemente
        journeyBtn.style.display = "inline-block";
        journeyBtn.style.opacity = 0;
        setTimeout(() => {
            journeyBtn.style.transition = "opacity 2s";
            journeyBtn.style.opacity = 1;
        }, 100);
    }, 1000);
}

function startJourney() {
    // REDIRECIONAMENTO PARA O PRIMEIRO ENIGMA
    // Troque 'enigma1.html' pelo nome do seu arquivo do Galo/Pato
    window.location.href = "enigma3.html"; 
}

function onSuccess() {
    sfxResponse.play();
    vault.classList.add("solved");
    vignette.style.transition = "opacity 3s ease";
    vignette.style.opacity = 0.3;

    const buttons = document.querySelectorAll(".dial button");
    buttons.forEach(btn => btn.style.opacity = 0);
    
    // Esconde o botão da jornada se ele estiver lá
    journeyBtn.style.display = "none";

    hintMsg.style.opacity = 0;
    setTimeout(() => {
        hintMsg.innerText = "O mecanismo respondeu...";
        hintMsg.style.opacity = 1;
        hintMsg.style.color = "#fff";
        hintMsg.style.textShadow = "0 0 10px white";
    }, 1000);
}
</script>
 </body>
</html>
