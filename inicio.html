<!doctype html>
<html lang="pt-br">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>O Cofre</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html, body {
        width: 100%;
        height: 100%;
        font-family: 'Montserrat', sans-serif;
        background: black;
        color: white;
        overflow: hidden;
    }

    /* ---------- VINHETA (Bordas Escuras) ---------- */
    #vignette {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 100%);
        pointer-events: none; /* Deixa clicar através dela */
        z-index: 200;
        opacity: 0;
        transition: opacity 2s ease;
    }

    /* ---------- PRÓLOGO ---------- */
    #intro {
        position: fixed;
        inset: 0;
        background: black;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 40px;
        z-index: 100;
    }

    .intro-text {
        font-size: 1.4rem;
        opacity: 0;
        transition: opacity 1.5s;
        max-width: 600px;
        line-height: 1.6;
    }

    #start-btn {
        position: absolute;
        bottom: 12%;
        padding: 14px 36px;
        border: 1px solid white;
        background: transparent;
        color: white;
        border-radius: 30px;
        font-size: 1.1rem;
        cursor: pointer;
    }

    /* ---------- SALA ESCURA ---------- */
    #dark-room {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at center, #111 0%, #000 75%);
        display: none;
        opacity: 0;
        pointer-events: none;
        transition: opacity 2.5s ease;
        z-index: 50;
    }

    /* Animação de luz falhando (Flicker) */
    @keyframes flicker {
        0% { opacity: 1; }
        3% { opacity: 0.95; }
        6% { opacity: 1; }
        7% { opacity: 0.9; }
        8% { opacity: 1; }
        9% { opacity: 1; }
        10% { opacity: 0.92; }
        11% { opacity: 1; }
        100% { opacity: 1; }
    }

    /* ---------- IMAGEM DO COFRE ---------- */
    #chest {
        width: 260px;
        height: auto;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%) scale(1);
        transition: transform 0.6s ease;
        box-shadow: 0 0 40px rgba(255,255,255,0.12);
    }

    /* ---------- BOTÃO APROXIMAR ---------- */
    #approach-button {
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        padding: 14px 36px;
        border: 1px solid rgba(255,255,255,0.4);
        background: transparent;
        color: white;
        border-radius: 30px;
        font-size: 0.9rem;
        letter-spacing: 3px;
        cursor: pointer;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1.2s ease;
    }

    /* ---------- TELA DO COFRE (Zoom) ---------- */
    #vault {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at center, #222 0%, #000 70%);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1.5s ease;
        animation: flicker 4s infinite; /* Aplica o efeito de luz */
    }

    /* Efeito de Respiração (Sucesso) */
    @keyframes breathe {
        0% { background: radial-gradient(circle at center, #222 0%, #000 70%); }
        50% { background: radial-gradient(circle at center, #333 0%, #111 60%); }
        100% { background: radial-gradient(circle at center, #222 0%, #000 70%); }
    }

    #vault.solved {
        animation: breathe 3s infinite ease-in-out;
    }

    /* ---------- TRANCAS ---------- */
    .dials {
        display: flex;
        gap: 16px;
    }

    .dial {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .dial button {
        background: transparent;
        border: none;
        color: rgba(255,255,255,0.5);
        font-size: 1.4rem;
        cursor: pointer;
        transition: color 0.3s;
        padding: 10px;
    }

    .dial button:active {
        color: white;
    }

    .number {
        font-size: 2.4rem;
        margin: 8px 0;
        transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275), color 0.3s, text-shadow 0.3s;
    }

    /* Micro-feedback: Pop ao girar */
    .number.pop {
        transform: scale(1.2);
    }

    /* Micro-feedback: Dígito correto individual */
    .number.correct-digit {
        color: #fff;
        text-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
    }

    .hint {
        margin-top: 30px;
        font-size: 0.9rem;
        color: #aaa;
        opacity: 0.7;
    }

    audio {
        display: none;
    }
  </style>
 </head>
 <body>
  
  <div id="vignette"></div>

  <audio id="ambient" src="ambiente.mp3" loop></audio>
  <audio id="sfx-tick" src="tick.mp3"></audio>
  <audio id="sfx-lock" src="lock-correct.mp3"></audio>
  <audio id="sfx-response" src="vault-response.mp3"></audio>

  <div id="intro">
   <div class="intro-text" id="text"></div>
   <button id="start-btn">Iniciar</button>
  </div>

  <div id="dark-room">
   <img id="chest" src="cofre.png" alt="Cofre">
   <button id="approach-button">APROXIMAR-SE</button>
  </div>

  <div id="vault">
   <div class="dials" id="dials"></div>
   <div class="hint">Talvez nem tudo se abra de primeira.</div>
  </div>

<script>
const textEl = document.getElementById("text");
const intro = document.getElementById("intro");
const startBtn = document.getElementById("start-btn");
const darkRoom = document.getElementById("dark-room");
const approachBtn = document.getElementById("approach-button");
const chest = document.getElementById("chest");
const vault = document.getElementById("vault");
const vignette = document.getElementById("vignette");

// Áudios
const ambient = document.getElementById("ambient");
const sfxTick = document.getElementById("sfx-tick");
const sfxLock = document.getElementById("sfx-lock");
const sfxResponse = document.getElementById("sfx-response");

// Configuração de volume dos efeitos
sfxTick.volume = 0.4;
sfxLock.volume = 0.6;
sfxResponse.volume = 0.8;

const lines = [
    "Algumas coisas não foram feitas para serem abertas de imediato.",
    "Elas esperam.",
    "Não por tempo...",
    "Mas pela pessoa certa.",
    "Este cofre ficou aqui por muito tempo.",
    "Guardando fragmentos.",
    "Começos.",
    "Lembranças.",
    "Se você está vendo isso agora...",
    "Talvez seja porque chegou a hora de tentar."
];

let index = 0;

function showNextLine() {
    if (index >= lines.length) {
        setTimeout(() => {
            intro.style.opacity = 0;
            setTimeout(() => {
                intro.style.display = "none";

                // Entrada da Sala
                darkRoom.style.display = "block";
                vignette.style.opacity = 1; // Ativa vinheta

                setTimeout(() => {
                    darkRoom.style.opacity = 1;
                    darkRoom.style.pointerEvents = "auto";

                    setTimeout(() => {
                        approachBtn.style.opacity = 1;
                        approachBtn.style.pointerEvents = "auto";
                    }, 2000);
                }, 50);
            }, 1500);
        }, 2000);
        return;
    }

    textEl.style.opacity = 0;
    setTimeout(() => {
        textEl.innerText = lines[index];
        textEl.style.opacity = 1;
        index++;
        setTimeout(showNextLine, 2600);
    }, 800);
}

startBtn.onclick = () => {
    ambient.volume = 0;
    ambient.play();
    let v = 0;
    const fade = setInterval(() => {
        v += 0.02;
        ambient.volume = Math.min(v, 0.6);
        if (v >= 0.6) clearInterval(fade);
    }, 100);

    startBtn.style.display = "none";
    showNextLine();
};

/* ---------- APROXIMAÇÃO ---------- */
approachBtn.onclick = () => {
    chest.style.transform = "translate(-50%, -50%) scale(1.45)";
    
    // Suaviza vinheta levemente ao aproximar
    vignette.style.opacity = 0.6; 

    setTimeout(() => {
        darkRoom.style.opacity = 0;
        darkRoom.style.pointerEvents = "none";

        setTimeout(() => {
            darkRoom.style.display = "none";

            vault.style.display = "flex";
            setTimeout(() => {
                vault.style.opacity = 1;
                vault.style.pointerEvents = "auto";
                vignette.style.opacity = 1; // Reforça vinheta no close
            }, 50);
        }, 800);
    }, 500);
};

/* ---------- TRAVA & LÓGICA ---------- */
const PASSWORD = [6,1,4,2,9];
const dials = document.getElementById("dials");
let values = [0,0,0,0,0];
let isSolved = false;

values.forEach((_, i) => {
    const dial = document.createElement("div");
    dial.className = "dial";

    const up = document.createElement("button");
    up.innerText = "▲";
    up.onclick = () => update(i, 1);

    const num = document.createElement("div");
    num.className = "number";
    num.innerText = "0";

    const down = document.createElement("button");
    down.innerText = "▼";
    down.onclick = () => update(i, -1);

    dial.appendChild(up);
    dial.appendChild(num);
    dial.appendChild(down);
    dials.appendChild(dial);

    dial.num = num;
});

function update(i, delta) {
    if (isSolved) return; // Trava interação se já resolveu

    values[i] = (values[i] + delta + 10) % 10;
    const numEl = dials.children[i].num;
    numEl.innerText = values[i];

    // Efeito Visual: Pop (Zoom)
    numEl.classList.remove("pop");
    void numEl.offsetWidth; // Trigger reflow para reiniciar animação
    numEl.classList.add("pop");

    // Lógica de Som e Feedback Individual
    // Se este dígito específico estiver correto:
    if (values[i] === PASSWORD[i]) {
        sfxLock.currentTime = 0;
        sfxLock.play();
        numEl.classList.add("correct-digit"); // Brilho sutil
    } else {
        sfxTick.currentTime = 0;
        sfxTick.play();
        numEl.classList.remove("correct-digit");
    }

    // Verifica Senha Completa
    if (values.every((v, idx) => v === PASSWORD[idx])) {
        isSolved = true;
        onSuccess();
    }
}

function onSuccess() {
    // Som de resposta
    sfxResponse.play();

    // Reação Visual
    vault.classList.add("solved"); // Inicia respiração do fundo
    vignette.style.transition = "opacity 3s ease";
    vignette.style.opacity = 0.3; // Clareia as bordas

    // Desabilita botões visualmente
    const buttons = document.querySelectorAll(".dial button");
    buttons.forEach(btn => btn.style.opacity = 0);
    
    // Feedback na dica
    const hint = document.querySelector(".hint");
    hint.style.opacity = 0;
    setTimeout(() => {
        hint.innerText = "O mecanismo respondeu...";
        hint.style.opacity = 1;
        hint.style.color = "#fff";
        hint.style.textShadow = "0 0 10px white";
    }, 1000);
}
</script>
 </body>
</html>
500);
        }, 2000);
        return;
    }

    // Esconder texto atual
    textEl.style.opacity = 0;
    textEl.style.transform = "translateY(-10px)";
    
    setTimeout(() => {
        // Mostrar nova frase
        textEl.innerText = lines[index];
        textEl.style.opacity = 1;
        textEl.style.transform = "translateY(0)";
        index++;
        
        // Chamar próxima frase
        setTimeout(showNextLine, 2800);
    }, 800);
}

// Iniciar experiência
startBtn.onclick = () => {
    // Fade in do som ambiente
    ambient.volume = 0;
    ambient.play();
    let v = 0;
    const fade = setInterval(() => {
        v += 0.02;
        ambient.volume = Math.min(v, 0.5);
        if (v >= 0.5) clearInterval(fade);
    }, 100);

    startBtn.style.display = "none";
    showNextLine();
};

// Aproximação do cofre
approachBtn.onclick = () => {
    // Zoom no cofre
    chest.style.transform = "translate(-50%, -50%) scale(1.45)";
    
    // Esconder botão
    approachBtn.style.opacity = 0;
    approachBtn.style.pointerEvents = "none";

    setTimeout(() => {
        // Transição para tela do cofre
        darkRoom.style.opacity = 0;
        darkRoom.style.pointerEvents = "none";

        setTimeout(() => {
            darkRoom.style.display = "none";
            
            // Ajustar vinheta
            vignette.style.opacity = 0.9;
            
            // Mostrar tela do cofre
            vault.style.display = "flex";
            setTimeout(() => {
                vault.style.opacity = 1;
                vault.style.pointerEvents = "auto";
                
                // Criar trancas
                createDials();
            }, 100);
        }, 800);
    }, 600);
};

// Criar trancas (dígitos)
function createDials() {
    dials.innerHTML = "";
    
    values.forEach((_, i) => {
        const dial = document.createElement("div");
        dial.className = "dial";
        dial.id = `dial-${i}`;

        // Botão para cima
        const up = document.createElement("button");
        up.innerText = "▲";
        up.addEventListener("click", () => updateDial(i, 1));
        up.addEventListener("touchstart", (e) => {
            e.preventDefault();
            updateDial(i, 1);
        });

        // Número
        const num = document.createElement("div");
        num.className = "number";
        num.id = `number-${i}`;
        num.innerText = "0";

        // Botão para baixo
        const down = document.createElement("button");
        down.innerText = "▼";
        down.addEventListener("click", () => updateDial(i, -1));
        down.addEventListener("touchstart", (e) => {
            e.preventDefault();
            updateDial(i, -1);
        });

        dial.appendChild(up);
        dial.appendChild(num);
        dial.appendChild(down);
        dials.appendChild(dial);

        // Salvar referência
        dial.num = num;
    });
}

// Atualizar dígito
function updateDial(i, delta) {
    // Tocar som do giro
    playSound(tickSound);
    
    // Atualizar valor
    values[i] = (values[i] + delta + 10) % 10;
    
    // Atualizar display
    const numElement = document.getElementById(`number-${i}`);
    numElement.innerText = values[i];
    
    // Animação de zoom
    numElement.classList.add("zooming");
    setTimeout(() => {
        numElement.classList.remove("zooming");
    }, 300);
    
    // Verificar senha
    checkPassword();
}

// Verificar senha completa
function checkPassword() {
    // Verificar cada dígito
    let newCorrectDigits = values.map((v, idx) => v === PASSWORD[idx]);
    let changedDigits = [];
    
    // Encontrar dígitos que acabaram de ficar corretos
    newCorrectDigits.forEach((isCorrect, i) => {
        if (isCorrect && !correctDigits[i]) {
            changedDigits.push(i);
        }
    });
    
    // Atualizar estado
    correctDigits = newCorrectDigits;
    
    // Tocar som para dígitos que acabaram de ficar corretos
    if (changedDigits.length > 0) {
        playSound(correctSound);
        
        // Marcar dígitos corretos visualmente
        changedDigits.forEach(i => {
            const numElement = document.getElementById(`number-${i}`);
            numElement.classList.add("correct-digit");
        });
    }
    
    // Verificar se TODOS estão corretos
    const allCorrectNow = correctDigits.every(c => c);
    
    if (allCorrectNow && !allCorrect) {
        // PRIMEIRA VEZ que a senha está completa
        allCorrect = true;
        
        // Tocar som do cofre respondendo
        setTimeout(() => playSound(vaultSound), 400);
        
        // Mostrar feedback
        feedback.textContent = "O cofre respondeu...";
        feedback.style.opacity = 1;
        
        // Animação de respiração no fundo
        vault.classList.add("breathing");
        
        // Suavizar vinheta
        vignette.style.opacity = 0.4;
        vignette.style.transition = "opacity 2s ease";
        
        // Animar cofre (se estivesse visível)
        if (chest) {
            chest.classList.add("chest-responding");
        }
        
        // Atualizar hint
        document.querySelector(".hint").textContent = "Algo se moveu dentro do cofre...";
        document.querySelector(".hint").style.color = "#d4af37";
        
    } else if (!allCorrectNow && allCorrect) {
        // Senha deixou de estar correta
        allCorrect = false;
        feedback.style.opacity = 0;
        vault.classList.remove("breathing");
        vignette.style.opacity = 0.9;
        
        if (chest) {
            chest.classList.remove("chest-responding");
        }
        
        // Remover marcação dos dígitos corretos
        correctDigits.forEach((isCorrect, i) => {
            if (!isCorrect) {
                const numElement = document.getElementById(`number-${i}`);
                numElement.classList.remove("correct-digit");
            }
        });
    }
}

// Inicializar
createDials();
</script>
</body>
</html>