<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Enigma 5 - O Diário sobre a Mesa</title>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Bangers&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            /* Fundo de mesa de madeira */
            background: url('https://www.transparenttextures.com/patterns/wood-pattern.png'), #3e2723;
            background-blend-mode: multiply;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Indie Flower', cursive;
            perspective: 1000px; /* Necessário para o efeito 3D */
        }

        /* Container para o efeito de zoom */
        #table-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            /* Visão distante padrão: menor e inclinado */
            transform: scale(0.85) rotateX(10deg) translateY(20px);
        }

        /* Classe ativada quando Henrique escreve */
        #table-container.writing-mode {
            /* Zoom in: aproxima e endireita o caderno */
            transform: scale(1) rotateX(0deg) translateY(0);
        }

        /* --- O CADERNO BROCHURA --- */
        #notebook {
            width: 90%;
            max-width: 480px;
            height: 80vh; /* Um pouco menor para caber na mesa */
            background: #fdf5e6;
            /* Textura de papel + sombra central simulando a dobra da brochura */
            background-image: 
                linear-gradient(to right, rgba(0,0,0,0.02) 0%, rgba(0,0,0,0.08) 48%, rgba(0,0,0,0.08) 52%, rgba(0,0,0,0.02) 100%),
                radial-gradient(#d1d1d1 1px, transparent 1px);
            background-size: 100% 100%, 20px 20px;
            /* Sombra realista na mesa */
            box-shadow: 0 20px 30px rgba(0,0,0,0.5), 0 5px 10px rgba(0,0,0,0.2);
            border-radius: 15px; /* Cantos arredondados de brochura */
            padding: 50px 35px 150px 35px;
            position: relative;
            overflow-y: auto;
            /* Esconde a barra de rolagem para ficar mais limpo */
            scrollbar-width: none; 
        }
        #notebook::-webkit-scrollbar { display: none; }

        #paper-content {
            color: #2c3e50;
            font-size: 1.2rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .title {
            font-weight: bold;
            font-size: 1.4rem;
            text-align: center;
            margin-bottom: 30px;
            display: block;
            color: #5d4037;
        }

        /* --- UI (BALÕES) --- */
        /* A UI fica fora do container da mesa para não sofrer zoom/inclinação */
        .ui-layer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
        }

        .bubble-container {
            position: absolute;
            bottom: 80px;
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bubble {
            background: #fff;
            color: #000;
            border: 3px solid #000;
            border-radius: 20px;
            padding: 15px;
            width: 85%;
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            font-weight: 700;
            position: relative;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.8);
            margin-bottom: 15px;
            pointer-events: all;
            display: none;
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .bubble::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 30px;
            border-width: 15px 15px 0;
            border-style: solid;
            border-color: #000 transparent;
            display: block;
            width: 0;
        }

        @keyframes pop { from { transform: scale(0) translateY(20px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }

        /* --- INTERAÇÕES --- */
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            pointer-events: all;
            width: 90%;
        }

        .btn-opt {
            background: #fff;
            color: #000;
            border: 2px solid #000;
            padding: 12px 15px;
            font-family: 'Bangers', cursive;
            font-size: 1.1rem;
            letter-spacing: 1px;
            cursor: pointer;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.8);
            transition: 0.2s;
            flex: 1 1 auto;
            text-align: center;
        }

        .btn-opt:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0 rgba(0,0,0,0.8); }

        #name-input-area {
            display: none;
            margin-top: 10px;
            pointer-events: all;
            background: #fff;
            padding: 5px;
            border: 2px solid #000;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.8);
        }

        input {
            border: none; padding: 10px; font-family: 'Space Mono'; outline: none; font-weight: bold; font-size: 1rem;
        }
    </style>
</head>
<body>

    <div id="table-container">
        <div id="notebook">
            <div id="paper-content"></div>
        </div>
    </div>

    <div class="ui-layer">
        <div class="bubble-container">
            <div id="henrique-bubble" class="bubble"></div>
            <div id="interaction-area" class="options"></div>
            
            <div id="name-input-area">
                <input type="text" id="larissa-name" placeholder="Digite seu nome..." autocomplete="off">
                <button class="btn-opt" onclick="submitName()" style="box-shadow: none; border: none; border-left: 2px solid #000;">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        const paper = document.getElementById('paper-content');
        const bubble = document.getElementById('henrique-bubble');
        const interaction = document.getElementById('interaction-area');
        const nameArea = document.getElementById('name-input-area');
        const notebook = document.getElementById('notebook');
        const tableContainer = document.getElementById('table-container');
        
        let userName = "Larissa";

        // --- FUNÇÃO DE ESCRITA COM ZOOM ---
        function typeInPaper(text, isTitle = false, callback) {
            // 1. Ativa o modo de escrita (Zoom IN)
            tableContainer.classList.add('writing-mode');

            let i = 0;
            const span = document.createElement('span');
            if(isTitle) span.className = 'title';
            if(!isTitle && paper.innerHTML !== "") span.innerHTML = "<br><br>";
            paper.appendChild(span);
            
            notebook.scrollTop = notebook.scrollHeight;

            const interval = setInterval(() => {
                span.innerHTML += text.charAt(i);
                i++;
                notebook.scrollTop = notebook.scrollHeight;
                if (i >= text.length) {
                    clearInterval(interval);
                    if(callback) {
                        // 2. Espera um pouco e desativa o modo de escrita (Zoom OUT) antes de mostrar os balões
                        setTimeout(() => {
                            tableContainer.classList.remove('writing-mode');
                            setTimeout(callback, 800); // Espera a animação de zoom out terminar
                        }, 500);
                    }
                }
            }, 50); // Velocidade da escrita
        }

        function talk(text, options = []) {
            bubble.style.display = "block";
            bubble.innerHTML = `<strong>Henrique:</strong> ${text}`;
            interaction.innerHTML = "";
            
            if(options.length > 0) {
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "btn-opt";
                    btn.innerText = opt.label;
                    btn.onclick = () => {
                        bubble.style.display = "none";
                        interaction.innerHTML = "";
                        opt.action();
                    };
                    interaction.appendChild(btn);
                });
            }
        }

        // --- ATO 1: INÍCIO ---
        window.onload = () => {
            setTimeout(() => {
                // Começa já com zoom para o título
                typeInPaper("Alice e Henrique — Uma amizade improvável em Harvard (por Henrique)", true, () => {
                    talk("Espera... tem alguém aí? Eu... eu não esperava visitas agora. Quem é você? Como você entrou aqui?", [
                        { label: "Responder...", action: () => { nameArea.style.display = "flex"; } }
                    ]);
                });
            }, 800);
        };

        function submitName() {
            const inputVal = document.getElementById('larissa-name').value;
            userName = inputVal.trim() !== "" ? inputVal : "Larissa";
            nameArea.style.display = "none";
            // O zoom out já aconteceu no callback do typeInPaper, então aqui estamos na visão distante
            talk(`${userName}? Que engraçado, você me lembra muito a Alice...`, [
                { label: "Alice? Quem é essa?", action: introAlice },
                { label: "Cadê o dígito?", action: responderDigito },
                { label: "Esperar em silêncio...", action: introSilencio }
            ]);
        }

        function responderDigito() {
            talk("Que dígito? Não sei de nenhum. Só sei que este sistema guarda memórias.", [
                { label: "Quem é Alice?", action: introAlice },
                { label: "Esperar em silêncio...", action: introSilencio }
            ]);
        }

        function introSilencio() {
            talk("Você se parece mesmo com ela, acho que posso confiar em você então... Quer acompanhar a história?", [
                { label: "Sim, quero acompanhar!", action: comecarHistoria },
                { label: "Não, eu não quero saber...", action: forcarHistoria }
            ]);
        }

        function introAlice() {
            talk("Alice é a minha melhor amiga, ia escrever agora a nossa história da nossa amizade. Quer acompanhar?", [
                { label: "Sim, quero acompanhar!", action: comecarHistoria },
                { label: "Não, eu não quero saber...", action: forcarHistoria }
            ]);
        }

        function forcarHistoria() {
            talk("Não quer?? Vai acompanhar sim!", [
                { label: "Tá bom...", action: comecarHistoria }
            ]);
        }

        // --- ATO 3 & 5: A HISTÓRIA NO CADERNO ---
        function comecarHistoria() {
            const texto1 = "Bom, como eu ia dizendo...\n\nHenrique (eu), sou uma pessoa bem introvertida e tímida, prefiro observar e ouvir do que falar. Até que sou inteligente, para algumas coisas, mas absurdamente inteligente, com certeza não. Me considero bem compreensível, sempre escuto as pessoas.\n\nApesar disso, eu sempre me senti perdido, não sabia ao certo o que fazer, sempre tento chegar em uma resposta, porém, nunca dá certo. Até que chega uma oportunidade de um curso em Harvard, chamado 'Projeto de Vida', ele prometia ajudar as pessoas a se encontrarem... Então decidi me inscrever.\n\nUns dias antes, em um final de semana, vou na casa de Giovanna (minha prima) e de seu futuro esposo...";
            
            // A função typeInPaper cuidará do zoom in e zoom out automaticamente
            typeInPaper(texto1, false, () => {
                talk("...", [
                    { label: "Tá, mas cadê a Alice nessa história?", action: reagirAlice },
                    { label: "E você achou a resposta nesse curso?", action: reagirResposta }
                ]);
            });
        }

        function reagirAlice() {
            talk("Meu Deus, calma. Ela já vai aparecer. Você parece mesmo ela...", [
                { label: "Continua...", action: historiaAlice }
            ]);
        }

        function reagirResposta() {
            talk(`Está pulando etapas, ${userName}. Mas eu diria que não exatamente, você vai me entender. Posso continuar?`, [
                { label: "Tá bom, continua.", action: historiaAlice }
            ]);
        }

        function historiaAlice() {
            const texto2 = "Nesse jantar acabo comentando com o Lúcio que eu iria fazer um curso em Harvard. Ele perguntou qual curso era, eu falo 'Projeto de Vida', e então ele fala que achava que era o mesmo curso que Giovanna faria.\n\nEntão mais tarde daquela noite, Giovanna decide ligar para Alice, chamando ela para fazer o curso. As duas conversam, e pelo o que parece, Alice iria fazer esse curso também...\n\nAlice era uma pessoa 'energética', ligada no 220, ela iluminava o ambiente que estava. Ela é extrovertida, sempre com um olhar curioso. Amava Medicina em Harvard. Outra paixão eram os livros e as séries. Completamente o oposto de mim. Alice ia atrás, Henrique nem tanto.";
            
            typeInPaper(texto2, false, () => {
                talk("...", [
                    { label: "Ligada no 220v? Achava ela cansativa?", action: reagir220 },
                    { label: "Realmente, são bem diferentes...", action: reagirDiferente },
                    { label: "E por que você não ia atrás também?", action: reagirMedo }
                ]);
            });
        }

        function reagir220() {
            talk("Nãooo! Não mesmo! É um elogio, o jeito dela cativava, muito diferente do meu.", [
                { label: "Ah bom, achei que estava falando mal.", action: () => talk("Nunca! Longe de mim isso. Vou continuar.") },
                { label: "Quanto elogio, acho que é falso!", action: () => talk(`Meu Deus, você é igual a ela... Deixa eu continuar, ${userName}.`) }
            ]);
        }

        function reagirDiferente() {
            talk("Muito. Mas acho que era exatamente disso que eu precisava. Alguém que não tivesse medo de ir atrás, já que eu passava tempo demais pensando em como ir.", [
                { label: "Entendo... continua.", action: () => { /* Próximo Ato */ } }
            ]);
        }

        function reagirMedo() {
            talk(`Não sei muito bem. Acho que era medo da mudança. Mas a Alice e Giovanna me ajudaram muito. Você vai ver, ${userName}.`, [
                { label: "Pode continuar.", action: () => { /* Próximo Ato */ } }
            ]);
        }
    </script>
</body>
</html>
