<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Cofre</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  width: 100%;
  height: 100%;
  background: black;
  font-family: 'Montserrat', sans-serif;
  overflow: hidden;
}

/* ===== START ===== */
#start-screen {
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 100;
}

#start-button {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.4);
  color: white;
  padding: 18px 50px;
  letter-spacing: 4px;
  border-radius: 40px;
  cursor: pointer;
  font-size: 1rem;
}

/* ===== STORY ===== */
#story {
  position: fixed;
  inset: 0;
  background: black;
  color: #ddd;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 40px;
  text-align: center;
  font-size: 1.3rem;
  opacity: 0;
  z-index: 10;
}

.story-line {
  opacity: 0;
  transition: opacity 1.5s ease;
}

/* ===== SALA ===== */
#dark-room {
  position: fixed;
  inset: 0;
  background: #050505;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 2s ease;
}

#room-light {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle, rgba(255,240,200,0.15), transparent 70%);
  opacity: 0;
  transition: opacity 3s ease;
}

/* ===== COFRE CSS ===== */
#css-chest-container {
  position: relative;
  width: 220px;
  height: 280px;
  opacity: 0;
  transition: opacity 2s ease, transform 1.2s ease;
}

.chest-body {
  width: 100%;
  height: 100%;
  background: linear-gradient(145deg, #3a3a3a, #222);
  border-radius: 14px;
  box-shadow: inset 0 0 30px rgba(0,0,0,.8);
  position: relative;
}

.chest-door {
  position: absolute;
  inset: 15px;
  background: linear-gradient(135deg, #333, #222);
  border-radius: 10px;
}

.chest-handle {
  position: absolute;
  top: 50%;
  right: 25px;
  width: 36px;
  height: 36px;
  background: radial-gradient(circle, #555, #333);
  border-radius: 50%;
  transform: translateY(-50%);
}

/* ===== BOTÃO ===== */
#approach-button {
  position: absolute;
  bottom: 80px;
  background: transparent;
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 12px 36px;
  letter-spacing: 3px;
  border-radius: 30px;
  opacity: 0;
}

/* ===== LOCK ===== */
#lock-screen {
  position: fixed;
  inset: 0;
  background: #0f0f0f;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1.5s ease;
}

.lock {
  display: flex;
  gap: 12px;
}

.digit {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.digit button {
  background: none;
  border: none;
  color: #aaa;
  font-size: 1.4rem;
}

.digit span {
  font-size: 2rem;
  margin: 6px 0;
}

/* ===== ZOOM ===== */
.zoom-in {
  transform: scale(1.4);
}
</style>
</head>

<body>

<div id="start-screen">
  <button id="start-button">INICIAR</button>
</div>

<div id="story">
  <div class="story-line" id="line"> </div>
</div>

<div id="dark-room">
  <div id="room-light"></div>

  <div id="css-chest-container">
    <div class="chest-body">
      <div class="chest-door">
        <div class="chest-handle"></div>
      </div>
    </div>
  </div>

  <button id="approach-button">APROXIMAR-SE</button>
</div>

<div id="lock-screen">
  <div>
    <h3 style="text-align:center;margin-bottom:20px;">Digite a combinação</h3>
    <div class="lock" id="lock"></div>
  </div>
</div>

<audio id="ambient" src="ambiente.mp3" loop></audio>

<script>
const startBtn = document.getElementById("start-button");
const startScreen = document.getElementById("start-screen");
const story = document.getElementById("story");
const line = document.getElementById("line");
const darkRoom = document.getElementById("dark-room");
const roomLight = document.getElementById("room-light");
const chest = document.getElementById("css-chest-container");
const approach = document.getElementById("approach-button");
const lockScreen = document.getElementById("lock-screen");
const lock = document.getElementById("lock");
const ambient = document.getElementById("ambient");

const text = [
  "Não foi feito para ser encontrado.",
  "Ainda assim, alguém deixou isso aqui.",
  "Cinco números guardam o que foi deixado."
];

const PASSWORD = [6,2,1,4,9];
let digits = [0,0,0,0,0];

startBtn.onclick = () => {
  startScreen.style.display = "none";
  ambient.volume = 0.4;
  ambient.play();
  startStory();
};

function startStory(){
  story.style.opacity = 1;
  let i = 0;

  function next(){
    if(i>0) line.style.opacity = 0;
    if(i < text.length){
      setTimeout(()=>{
        line.textContent = text[i];
        line.style.opacity = 1;
        i++;
        setTimeout(next, 3000);
      }, 1000);
    } else {
      setTimeout(()=>{
        story.style.opacity = 0;
        startRoom();
      }, 2000);
    }
  }
  next();
}

function startRoom(){
  darkRoom.style.opacity = 1;
  darkRoom.style.pointerEvents = "auto";
  setTimeout(()=>roomLight.style.opacity=1,500);
  setTimeout(()=>chest.style.opacity=1,2000);
  setTimeout(()=>approach.style.opacity=1,3500);
}

approach.onclick = ()=>{
  chest.classList.add("zoom-in");
  setTimeout(()=>{
    darkRoom.style.opacity = 0;
    lockScreen.style.opacity = 1;
    lockScreen.style.pointerEvents = "auto";
    renderLock();
  },1200);
};

function renderLock(){
  lock.innerHTML="";
  digits.forEach((n,i)=>{
    const d=document.createElement("div");
    d.className="digit";
    const up=document.createElement("button");
    up.textContent="▲";
    up.onclick=()=>change(i,1);
    const span=document.createElement("span");
    span.textContent=n;
    const down=document.createElement("button");
    down.textContent="▼";
    down.onclick=()=>change(i,-1);
    d.append(up,span,down);
    lock.appendChild(d);
  });
}

function change(i,delta){
  digits[i]=(digits[i]+delta+10)%10;
  renderLock();
}
</script>

</body>
</html> opacity 1.5s ease;
  z-index: 20;
}

.lock-box {
  text-align: center;
  width: 90%;
  max-width: 400px;
}

.lock-box h2 {
  font-weight: 300;
  margin-bottom: 30px;
  letter-spacing: 2px;
  font-size: 1.2rem;
}

/* ===== TRAVA VERTICAL ===== */
.lock {
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
}

.digit {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 60px;
}

.digit button {
  background: none;
  border: none;
  color: #888;
  font-size: 1.4rem;
  cursor: pointer;
  padding: 10px;
  touch-action: manipulation;
  min-height: 44px;
  min-width: 44px;
}

.digit span {
  font-size: 2.2rem;
  margin: 8px 0;
  width: 24px;
  text-align: center;
  min-height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== FEEDBACK ===== */
#feedback {
  margin-top: 25px;
  font-size: 0.9rem;
  color: #777;
  min-height: 20px;
}

/* Media Queries para celular */
@media (max-width: 768px) {
  #story {
    font-size: 1.1rem;
    padding: 20px;
  }
  
  .story-line {
    margin-bottom: 20px;
  }
  
  .lock {
    gap: 8px;
  }
  
  .digit {
    min-width: 50px;
  }
  
  .digit button {
    font-size: 1.2rem;
    padding: 8px;
  }
  
  .digit span {
    font-size: 1.8rem;
  }
  
  #approach-button {
    bottom: 60px;
    padding: 15px 40px;
    font-size: 1rem;
  }
  
  #css-chest-container {
    transform: scale(0.9);
  }
}
</style>
</head>

<body>

<!-- STORY com frases separadas -->
<div id="story">
  <div class="story-line" id="line1">Não foi feito para ser encontrado.</div>
  <div class="story-line" id="line2">Ainda assim, alguém deixou isso aqui.</div>
  <div class="story-line" id="line3">Cinco números guardam o que foi deixado.</div>
</div>

<!-- LUZ -->
<div id="light-layer"></div>

<!-- FADE PARA PRETO -->
<div id="fade-black"></div>

<!-- SALA ESCURA -->
<div id="dark-room">
  <!-- Luz da sala -->
  <div id="room-light"></div>
  
  <!-- Cofre desenhado em CSS -->
  <div id="css-chest-container">
    <div class="chest-body">
      <div class="chest-door">
        <!-- Maçaneta -->
        <div class="chest-handle"></div>
        
        <!-- Linhas decorativas -->
        <div class="chest-lines">
          <div class="vertical-line"></div>
          <div class="horizontal-line"></div>
        </div>
        
        <!-- Parafusos -->
        <div class="screw screw-1"></div>
        <div class="screw screw-2"></div>
        <div class="screw screw-3"></div>
        <div class="screw screw-4"></div>
      </div>
    </div>
    
    <!-- Sombra do cofre -->
    <div class="chest-shadow"></div>
  </div>
  
  <!-- Botão de aproximação -->
  <button id="approach-button" class="pulse">APROXIMAR-SE</button>
</div>

<!-- COFRE (antigo - mantido) -->
<div id="chest-scene">
  <img src="cofre.png" id="chest" alt="Cofre">
  <div id="hint">toque para se aproximar</div>
</div>

<!-- TELA DA TRAVA -->
<div id="lock-screen">
  <div class="lock-box">
    <h2>Digite a combinação</h2>

    <div class="lock" id="lock">
      <!-- dígitos -->
    </div>

    <div id="feedback"></div>
  </div>
</div>

<audio id="ambient" src="ambiente.mp3" loop></audio>

<script>
// Elementos DOM
const story = document.getElementById("story");
const line1 = document.getElementById("line1");
const line2 = document.getElementById("line2");
const line3 = document.getElementById("line3");
const light = document.getElementById("light-layer");
const fadeBlack = document.getElementById("fade-black");
const darkRoom = document.getElementById("dark-room");
const roomLight = document.getElementById("room-light");
const cssChestContainer = document.getElementById("css-chest-container");
const approachButton = document.getElementById("approach-button");
const chestScene = document.getElementById("chest-scene");
const chest = document.getElementById("chest");
const lockScreen = document.getElementById("lock-screen");
const lockContainer = document.getElementById("lock");
const feedback = document.getElementById("feedback");
const ambient = document.getElementById("ambient");

const PASSWORD = [6, 2, 1, 4, 9];
let digits = [0, 0, 0, 0, 0];

// Função para ativar som após interação
function startAmbientSound() {
  if (ambient.paused) {
    ambient.volume = 0.4;
    ambient.play().catch(e => console.log("Som precisa de interação do usuário"));
  }
}

// Ativar som no primeiro toque
document.addEventListener('touchstart', startAmbientSound, { once: true });
document.addEventListener('click', startAmbientSound, { once: true });

// Sequência narrativa aprimorada
function startStorySequence() {
  // Primeira frase aparece imediatamente
  setTimeout(() => {
    line1.classList.add('active');
  }, 1000);
  
  // Segunda frase após 3 segundos
  setTimeout(() => {
    line2.classList.add('active');
  }, 4000);
  
  // Terceira frase após 6 segundos
  setTimeout(() => {
    line3.classList.add('active');
  }, 7000);
  
  // Fade out do prólogo após 10 segundos
  setTimeout(() => {
    story.style.opacity = 0;
  }, 10000);
  
  // Luz do prólogo
  setTimeout(() => {
    light.style.opacity = 1;
  }, 12000);
  
  // Fade para preto
  setTimeout(() => {
    fadeBlack.style.opacity = 1;
    fadeBlack.style.pointerEvents = "auto";
  }, 13000);
  
  // Cena da sala escura
  setTimeout(() => {
    fadeBlack.style.opacity = 0;
    darkRoom.style.opacity = 1;
    darkRoom.style.pointerEvents = "auto";
    
    // Acender luz gradualmente
    setTimeout(() => {
      roomLight.style.opacity = 1;
    }, 500);
    
    // Revelar cofre desenhado em CSS
    setTimeout(() => {
      cssChestContainer.style.opacity = 1;
    }, 2000);
    
    // Mostrar botão de aproximação
    setTimeout(() => {
      approachButton.style.opacity = 1;
      approachButton.style.pointerEvents = "auto";
    }, 3500);
  }, 15000);
}

// Iniciar sequência
startStorySequence();

// CORREÇÃO: Botão de aproximação para celular
approachButton.addEventListener('click', handleApproachButton);
approachButton.addEventListener('touchstart', handleApproachButton);

function handleApproachButton(e) {
  e.preventDefault();
  e.stopPropagation();
  
  // Remover ouvintes para evitar múltiplos cliques
  approachButton.removeEventListener('click', handleApproachButton);
  approachButton.removeEventListener('touchstart', handleApproachButton);
  
  // 5️⃣ Transição para a tela da senha
  darkRoom.style.opacity = 0;
  darkRoom.style.pointerEvents = "none";
  
  setTimeout(() => {
    lockScreen.style.opacity = 1;
    lockScreen.style.pointerEvents = "auto";
    renderLock();
  }, 1500);
}

// criar tranca (mantido do código original)
function renderLock() {
  lockContainer.innerHTML = "";

  digits.forEach((num, i) => {
    const d = document.createElement("div");
    d.className = "digit";

    const up = document.createElement("button");
    up.innerHTML = "▲";
    up.addEventListener('click', () => changeDigit(i, 1));
    up.addEventListener('touchstart', (e) => {
      e.preventDefault();
      changeDigit(i, 1);
    });

    const span = document.createElement("span");
    span.textContent = num;

    const down = document.createElement("button");
    down.innerHTML = "▼";
    down.addEventListener('click', () => changeDigit(i, -1));
    down.addEventListener('touchstart', (e) => {
      e.preventDefault();
      changeDigit(i, -1);
    });

    d.appendChild(up);
    d.appendChild(span);
    d.appendChild(down);

    lockContainer.appendChild(d);
  });
}

function changeDigit(index, delta) {
  digits[index] = (digits[index] + delta + 10) % 10;
  renderLock();
  checkPassword();
}

function checkPassword() {
  const correct = digits.every((n, i) => n === PASSWORD[i]);

  if (correct) {
    feedback.textContent = "O cofre respondeu.";
    feedback.style.color = "#9f9";
    // daqui em diante entra o próximo enigma
  } else {
    feedback.textContent = "";
  }
}

// Clique no cofre (código original mantido para compatibilidade)
chest.addEventListener('click', () => {
  chestScene.style.opacity = 0;
  chestScene.style.pointerEvents = "none";

  setTimeout(() => {
    lockScreen.style.opacity = 1;
    lockScreen.style.pointerEvents = "auto";
    renderLock();
  }, 1200);
});

// Para toque no celular
chest.addEventListener('touchstart', (e) => {
  e.preventDefault();
  chestScene.style.opacity = 0;
  chestScene.style.pointerEvents = "none";

  setTimeout(() => {
    lockScreen.style.opacity = 1;
    lockScreen.style.pointerEvents = "auto";
    renderLock();
  }, 1200);
});

// Iniciar a trava (caso entre diretamente na tela)
renderLock();
</script>

</body>
</html>