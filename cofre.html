<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Cofre</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  background: black;
  font-family: 'Montserrat', sans-serif;
  overflow: hidden;
}

/* ===== STORY ===== */
#story {
  position: fixed;
  inset: 0;
  background: black;
  color: #ddd;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 40px;
  text-align: center;
  font-size: 1.3rem;
  line-height: 1.6;
  opacity: 1;
  transition: opacity 2s ease;
  z-index: 10;
}

/* ===== LUZ ===== */
#light-layer {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, rgba(255,255,200,0.15), black 70%);
  opacity: 0;
  transition: opacity 4s ease;
  z-index: 5;
}

/* ===== COFRE ===== */
#chest-scene {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 3s ease;
  z-index: 6;
}

#chest {
  width: 220px;
  cursor: pointer;
  transition: transform 0.4s ease;
}

#chest:hover {
  transform: scale(1.05);
}

#hint {
  margin-top: 20px;
  color: #aaa;
  font-size: 0.9rem;
  letter-spacing: 2px;
  opacity: 0.7;
}

/* ===== TELA DA TRAVA ===== */
#lock-screen {
  position: fixed;
  inset: 0;
  background: #0f0f0f;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1.5s ease;
  z-index: 20;
}

.lock-box {
  text-align: center;
}

.lock-box h2 {
  font-weight: 300;
  margin-bottom: 30px;
  letter-spacing: 2px;
}

/* ===== TRAVA VERTICAL ===== */
.lock {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.digit {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.digit button {
  background: none;
  border: none;
  color: #888;
  font-size: 1.4rem;
  cursor: pointer;
}

.digit span {
  font-size: 2.2rem;
  margin: 8px 0;
  width: 24px;
  text-align: center;
}

/* ===== FEEDBACK ===== */
#feedback {
  margin-top: 25px;
  font-size: 0.9rem;
  color: #777;
  min-height: 20px;
}
</style>
</head>

<body>

<!-- STORY -->
<div id="story">
  <p>
    Não foi feito para ser encontrado.<br><br>
    Ainda assim, alguém deixou isso aqui.<br><br>
    Cinco números guardam o que foi deixado.
  </p>
</div>

<!-- LUZ -->
<div id="light-layer"></div>

<!-- COFRE -->
<div id="chest-scene">
  <img src="cofre.png" id="chest" alt="Cofre">
  <div id="hint">toque para se aproximar</div>
</div>

<!-- TELA DA TRAVA -->
<div id="lock-screen">
  <div class="lock-box">
    <h2>Digite a combinação</h2>

    <div class="lock" id="lock">
      <!-- dígitos -->
    </div>

    <div id="feedback"></div>
  </div>
</div>

<audio id="ambient" src="ambiente.mp3" loop></audio>

<script>
const story = document.getElementById("story");
const light = document.getElementById("light-layer");
const chestScene = document.getElementById("chest-scene");
const chest = document.getElementById("chest");
const lockScreen = document.getElementById("lock-screen");
const lockContainer = document.getElementById("lock");
const feedback = document.getElementById("feedback");
const ambient = document.getElementById("ambient");

const PASSWORD = [6, 2, 1, 4, 9];
let digits = [0, 0, 0, 0, 0];

// iniciar som após interação
document.body.addEventListener("click", () => {
  ambient.volume = 0.4;
  ambient.play();
}, { once: true });

// sequência
setTimeout(() => story.style.opacity = 0, 6000);
setTimeout(() => light.style.opacity = 1, 8000);
setTimeout(() => {
  chestScene.style.opacity = 1;
  chestScene.style.pointerEvents = "auto";
}, 11000);

// clique no cofre
chest.addEventListener("click", () => {
  chestScene.style.opacity = 0;
  chestScene.style.pointerEvents = "none";

  setTimeout(() => {
    lockScreen.style.opacity = 1;
    lockScreen.style.pointerEvents = "auto";
  }, 1200);
});

// criar tranca
function renderLock() {
  lockContainer.innerHTML = "";

  digits.forEach((num, i) => {
    const d = document.createElement("div");
    d.className = "digit";

    const up = document.createElement("button");
    up.innerHTML = "▲";
    up.onclick = () => changeDigit(i, 1);

    const span = document.createElement("span");
    span.textContent = num;

    const down = document.createElement("button");
    down.innerHTML = "▼";
    down.onclick = () => changeDigit(i, -1);

    d.appendChild(up);
    d.appendChild(span);
    d.appendChild(down);

    lockContainer.appendChild(d);
  });
}

function changeDigit(index, delta) {
  digits[index] = (digits[index] + delta + 10) % 10;
  renderLock();
  checkPassword();
}

function checkPassword() {
  const correct = digits.every((n, i) => n === PASSWORD[i]);

  if (correct) {
    feedback.textContent = "O cofre respondeu.";
    feedback.style.color = "#9f9";
    // daqui em diante entra o próximo enigma
  } else {
    feedback.textContent = "";
  }
}

renderLock();
</script>

</body>
</html>