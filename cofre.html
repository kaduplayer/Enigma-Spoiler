<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Cofre</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  background: black;
  font-family: 'Montserrat', sans-serif;
  overflow: hidden;
}

/* ===== STORY ===== */
#story {
  position: fixed;
  inset: 0;
  background: black;
  color: #ddd;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 40px;
  text-align: center;
  font-size: 1.3rem;
  line-height: 1.6;
  opacity: 1;
  transition: opacity 2s ease;
  z-index: 10;
}

/* ===== LUZ ===== */
#light-layer {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, rgba(255,255,200,0.15), black 70%);
  opacity: 0;
  transition: opacity 4s ease;
  z-index: 5;
}

/* ===== FADE TO BLACK ===== */
#fade-black {
  position: fixed;
  inset: 0;
  background: black;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s ease;
  z-index: 7;
}

/* ===== SALA ESCURA ===== */
#dark-room {
  position: fixed;
  inset: 0;
  background: #050505;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 2s ease;
  z-index: 8;
}

/* ===== LUZ DA SALA ===== */
#room-light {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(
    circle at center,
    rgba(255, 240, 200, 0.12) 0%,
    rgba(255, 220, 150, 0.08) 20%,
    rgba(80, 60, 30, 0.03) 40%,
    transparent 70%
  );
  opacity: 0;
  transition: opacity 3s ease-in-out;
  z-index: 1;
}

/* ===== COFRE CSS ===== */
#css-chest-container {
  position: relative;
  width: 300px;
  height: 350px;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: opacity 2s ease;
  z-index: 2;
}

/* Estrutura principal do cofre */
.chest-body {
  position: relative;
  width: 220px;
  height: 280px;
  background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
  border-radius: 12px;
  box-shadow: 
    inset 0 0 30px rgba(0, 0, 0, 0.8),
    0 10px 40px rgba(0, 0, 0, 0.7),
    0 0 0 2px #222;
  overflow: hidden;
}

/* Porta do cofre */
.chest-door {
  position: absolute;
  top: 20px;
  left: 10px;
  width: 200px;
  height: 240px;
  background: linear-gradient(135deg, #333, #222);
  border-radius: 8px;
  box-shadow: 
    inset 0 0 20px rgba(0, 0, 0, 0.9),
    0 0 0 2px #444;
}

/* Maçaneta/trava */
.chest-handle {
  position: absolute;
  top: 50%;
  right: 25px;
  width: 40px;
  height: 40px;
  background: radial-gradient(circle, #555, #333);
  border-radius: 50%;
  transform: translateY(-50%);
  box-shadow: 
    inset 0 2px 4px rgba(0, 0, 0, 0.8),
    0 2px 6px rgba(0, 0, 0, 0.6);
  border: 2px solid #444;
}

/* Linhas decorativas */
.chest-lines {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 160px;
  height: 200px;
}

.vertical-line {
  position: absolute;
  top: 0;
  left: 50%;
  width: 4px;
  height: 100%;
  background: linear-gradient(to bottom, transparent, #555, transparent);
  border-radius: 2px;
}

.horizontal-line {
  position: absolute;
  left: 0;
  top: 50%;
  width: 100%;
  height: 4px;
  background: linear-gradient(to right, transparent, #555, transparent);
  border-radius: 2px;
}

/* Parafusos decorativos */
.screw {
  position: absolute;
  width: 12px;
  height: 12px;
  background: radial-gradient(circle, #666, #444);
  border-radius: 50%;
  box-shadow: 
    inset 0 1px 2px rgba(255, 255, 255, 0.1),
    0 1px 3px rgba(0, 0, 0, 0.5);
}

.screw-1 { top: 15px; left: 15px; }
.screw-2 { top: 15px; right: 15px; }
.screw-3 { bottom: 15px; left: 15px; }
.screw-4 { bottom: 15px; right: 15px; }

/* Sombra do cofre */
.chest-shadow {
  position: absolute;
  bottom: -20px;
  left: 50%;
  transform: translateX(-50%);
  width: 240px;
  height: 40px;
  background: radial-gradient(ellipse, rgba(0, 0, 0, 0.6), transparent 70%);
  border-radius: 50%;
  z-index: -1;
}

/* ===== BOTÃO DE APROXIMAÇÃO ===== */
#approach-button {
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.8);
  padding: 12px 30px;
  font-family: 'Montserrat', sans-serif;
  font-size: 0.9rem;
  letter-spacing: 3px;
  cursor: pointer;
  opacity: 0;
  transition: all 0.4s ease;
  backdrop-filter: blur(5px);
  border-radius: 30px;
  z-index: 3;
}

#approach-button:hover {
  background: rgba(255, 255, 255, 0.05);
  color: rgba(255, 255, 255, 0.9);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateX(-50%) scale(1.05);
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
}

/* Animação de pulso sutil */
@keyframes pulse-glow {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; }
}

.pulse {
  animation: pulse-glow 2s ease-in-out infinite;
}

/* ===== COFRE (antigo - mantido) ===== */
#chest-scene {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 3s ease;
  z-index: 6;
}

#chest {
  width: 220px;
  cursor: pointer;
  transition: transform 0.4s ease;
}

#chest:hover {
  transform: scale(1.05);
}

#hint {
  margin-top: 20px;
  color: #aaa;
  font-size: 0.9rem;
  letter-spacing: 2px;
  opacity: 0.7;
}

/* ===== TELA DA TRAVA ===== */
#lock-screen {
  position: fixed;
  inset: 0;
  background: #0f0f0f;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1.5s ease;
  z-index: 20;
}

.lock-box {
  text-align: center;
}

.lock-box h2 {
  font-weight: 300;
  margin-bottom: 30px;
  letter-spacing: 2px;
}

/* ===== TRAVA VERTICAL ===== */
.lock {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.digit {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.digit button {
  background: none;
  border: none;
  color: #888;
  font-size: 1.4rem;
  cursor: pointer;
}

.digit span {
  font-size: 2.2rem;
  margin: 8px 0;
  width: 24px;
  text-align: center;
}

/* ===== FEEDBACK ===== */
#feedback {
  margin-top: 25px;
  font-size: 0.9rem;
  color: #777;
  min-height: 20px;
}
</style>
</head>

<body>

<!-- STORY -->
<div id="story">
  <p>
    Não foi feito para ser encontrado.<br><br>
    Ainda assim, alguém deixou isso aqui.<br><br>
    Cinco números guardam o que foi deixado.
  </p>
</div>

<!-- LUZ -->
<div id="light-layer"></div>

<!-- FADE PARA PRETO -->
<div id="fade-black"></div>

<!-- SALA ESCURA -->
<div id="dark-room">
  <!-- Luz da sala -->
  <div id="room-light"></div>
  
  <!-- Cofre desenhado em CSS -->
  <div id="css-chest-container">
    <div class="chest-body">
      <div class="chest-door">
        <!-- Maçaneta -->
        <div class="chest-handle"></div>
        
        <!-- Linhas decorativas -->
        <div class="chest-lines">
          <div class="vertical-line"></div>
          <div class="horizontal-line"></div>
        </div>
        
        <!-- Parafusos -->
        <div class="screw screw-1"></div>
        <div class="screw screw-2"></div>
        <div class="screw screw-3"></div>
        <div class="screw screw-4"></div>
      </div>
    </div>
    
    <!-- Sombra do cofre -->
    <div class="chest-shadow"></div>
  </div>
  
  <!-- Botão de aproximação -->
  <button id="approach-button" class="pulse">APROXIMAR-SE</button>
</div>

<!-- COFRE (antigo - mantido) -->
<div id="chest-scene">
  <img src="cofre.png" id="chest" alt="Cofre">
  <div id="hint">toque para se aproximar</div>
</div>

<!-- TELA DA TRAVA -->
<div id="lock-screen">
  <div class="lock-box">
    <h2>Digite a combinação</h2>

    <div class="lock" id="lock">
      <!-- dígitos -->
    </div>

    <div id="feedback"></div>
  </div>
</div>

<audio id="ambient" src="ambiente.mp3" loop></audio>

<script>
const story = document.getElementById("story");
const light = document.getElementById("light-layer");
const fadeBlack = document.getElementById("fade-black");
const darkRoom = document.getElementById("dark-room");
const roomLight = document.getElementById("room-light");
const cssChestContainer = document.getElementById("css-chest-container");
const approachButton = document.getElementById("approach-button");
const chestScene = document.getElementById("chest-scene");
const chest = document.getElementById("chest");
const lockScreen = document.getElementById("lock-screen");
const lockContainer = document.getElementById("lock");
const feedback = document.getElementById("feedback");
const ambient = document.getElementById("ambient");

const PASSWORD = [6, 2, 1, 4, 9];
let digits = [0, 0, 0, 0, 0];

// iniciar som após interação
document.body.addEventListener("click", () => {
  ambient.volume = 0.4;
  ambient.play();
}, { once: true });

// Sequência narrativa aprimorada
setTimeout(() => {
  story.style.opacity = 0; // Fade out do prólogo
}, 6000);

setTimeout(() => {
  light.style.opacity = 1; // Luz do prólogo
}, 8000);

setTimeout(() => {
  // 1️⃣ Fade para preto completo
  fadeBlack.style.opacity = 1;
  fadeBlack.style.pointerEvents = "auto";
}, 11000);

setTimeout(() => {
  // 2️⃣ Cena da sala escura
  fadeBlack.style.opacity = 0;
  darkRoom.style.opacity = 1;
  darkRoom.style.pointerEvents = "auto";
  
  // Acender luz gradualmente
  setTimeout(() => {
    roomLight.style.opacity = 1;
  }, 500);
  
  // Revelar cofre desenhado em CSS
  setTimeout(() => {
    cssChestContainer.style.opacity = 1;
  }, 2000);
  
  // Mostrar botão de aproximação
  setTimeout(() => {
    approachButton.style.opacity = 1;
  }, 3500);
}, 13000);

// 4️⃣ Interação: aproximar-se do cofre
approachButton.addEventListener("click", () => {
  // 5️⃣ Transição para a tela da senha
  darkRoom.style.opacity = 0;
  darkRoom.style.pointerEvents = "none";
  
  setTimeout(() => {
    lockScreen.style.opacity = 1;
    lockScreen.style.pointerEvents = "auto";
    renderLock();
  }, 1500);
});

// criar tranca (mantido do código original)
function renderLock() {
  lockContainer.innerHTML = "";

  digits.forEach((num, i) => {
    const d = document.createElement("div");
    d.className = "digit";

    const up = document.createElement("button");
    up.innerHTML = "▲";
    up.onclick = () => changeDigit(i, 1);

    const span = document.createElement("span");
    span.textContent = num;

    const down = document.createElement("button");
    down.innerHTML = "▼";
    down.onclick = () => changeDigit(i, -1);

    d.appendChild(up);
    d.appendChild(span);
    d.appendChild(down);

    lockContainer.appendChild(d);
  });
}

function changeDigit(index, delta) {
  digits[index] = (digits[index] + delta + 10) % 10;
  renderLock();
  checkPassword();
}

function checkPassword() {
  const correct = digits.every((n, i) => n === PASSWORD[i]);

  if (correct) {
    feedback.textContent = "O cofre respondeu.";
    feedback.style.color = "#9f9";
    // daqui em diante entra o próximo enigma
  } else {
    feedback.textContent = "";
  }
}

// Clique no cofre (código original mantido para compatibilidade)
chest.addEventListener("click", () => {
  chestScene.style.opacity = 0;
  chestScene.style.pointerEvents = "none";

  setTimeout(() => {
    lockScreen.style.opacity = 1;
    lockScreen.style.pointerEvents = "auto";
    renderLock();
  }, 1200);
});
</script>

</body>
</html>