<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragmento - Sistema de Segurança</title>

    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* Remove o brilho azul ao tocar no celular */
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Space Mono', monospace;
            background: #050505;
            color: #00ff41;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Efeito de Overlay de Terminal */
        body::after {
            content: " ";
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* INTRODUÇÃO */
        #intro {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            font-size: clamp(1rem, 4vw, 1.2rem);
            line-height: 1.6;
            opacity: 0;
            transition: opacity 1.5s ease;
            z-index: 50;
        }

        /* CONTAINER PRINCIPAL DO JOGO */
        #game {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 40px;
            width: 100%;
            max-width: 500px;
            padding: 20px;
            z-index: 10;
        }

        /* SÍMBOLOS RESPONSIVOS */
        .symbols {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2x2 no celular */
            gap: 20px;
        }

        /* No PC vira uma linha só */
        @media (min-width: 600px) {
            .symbols {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .symbol {
            width: 75px;
            height: 75px;
            border: 2px solid #00ff41;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: rgba(0, 255, 65, 0.05);
            transition: all 0.2s ease;
            user-select: none;
        }

        .symbol.active-flash {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 25px #00ff41;
            transform: scale(0.95);
        }

        /* BARRA DE PROGRESSO */
        .progress {
            display: flex;
            gap: 12px;
        }

        .dot {
            width: 14px;
            height: 14px;
            border: 1px solid #00ff41;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .dot.active { background: #00ff41; box-shadow: 0 0 8px #00ff41; }
        .dot.success { background: #fff; border-color: #fff; box-shadow: 0 0 15px #fff; }
        .dot.error { background: #ff4444; border-color: #ff4444; box-shadow: 0 0 8px #ff4444; }

        /* TELA FINAL */
        #final {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 20px;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .digit {
            font-size: clamp(5rem, 20vw, 8rem);
            font-weight: bold;
            text-shadow: 0 0 20px #00ff41;
        }

        button {
            padding: 12px 30px;
            background: transparent;
            border: 1px solid #00ff41;
            color: #00ff41;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 20px;
        }

        button:hover {
            background: #00ff41;
            color: #000;
        }

        /* Animação de tremor para erro */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
        .shake { animation: shake 0.4s ease-in-out; }
    </style>
</head>
<body>

    <audio id="sfx-click" src="click.mp3"></audio>
    <audio id="sfx-error" src="error.mp3"></audio>
    <audio id="sfx-success" src="success.mp3"></audio>

    <div id="intro">
        SISTEMA BLOQUEADO...<br>
        REFLITA A SEQUÊNCIA PARA DESBLOQUEAR.
    </div>

    <div id="game">
        <div class="symbols">
            <div class="symbol" data-id="0">Δ</div>
            <div class="symbol" data-id="1">Ω</div>
            <div class="symbol" data-id="2">Σ</div>
            <div class="symbol" data-id="3">Φ</div>
        </div>
        <div class="progress" id="progress"></div>
    </div>

    <div id="final">
        <p style="letter-spacing: 3px;">DÍGITO RECUPERADO</p>
        <div class="digit">3</div>
        <button onclick="next()">Continuar</button>
    </div>

    <script>
        const intro = document.getElementById('intro');
        const game = document.getElementById('game');
        const finalScreen = document.getElementById('final');
        const progressBox = document.getElementById('progress');
        const symbols = document.querySelectorAll('.symbol');

        const clickSound = document.getElementById('sfx-click');
        const errorSound = document.getElementById('sfx-error');
        const successSound = document.getElementById('sfx-success');

        let sequence = [];
        let userInput = [];
        const length = 4;

        // Início
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => intro.style.opacity = 1, 500);
            setTimeout(() => {
                intro.style.opacity = 0;
                setTimeout(() => {
                    intro.style.display = 'none';
                    game.style.display = 'flex';
                    initRound();
                }, 1500);
            }, 4500);
        });

        function initRound() {
            // Gera sequência aleatória
            sequence = Array.from({length: length}, () => Math.floor(Math.random() * 4));
            userInput = [];
            
            // Prepara as bolinhas de progresso
            progressBox.innerHTML = '';
            for (let i = 0; i < length; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                progressBox.appendChild(dot);
            }
            
            setTimeout(showSequence, 1000);
        }

        async function showSequence() {
            game.style.pointerEvents = 'none'; // Bloqueia cliques do jogador
            
            for (let id of sequence) {
                await new Promise(r => setTimeout(r, 700));
                flash(id);
            }
            
            await new Promise(r => setTimeout(r, 500));
            game.style.pointerEvents = 'all'; // Libera
        }

        function flash(id) {
            const el = document.querySelector(`[data-id="${id}"]`);
            el.classList.add('active-flash');
            
            // Play sound com reset para permitir repetições rápidas
            clickSound.currentTime = 0;
            clickSound.play().catch(()=>{});
            
            setTimeout(() => el.classList.remove('active-flash'), 400);
        }

        symbols.forEach(sym => {
            sym.addEventListener('click', () => {
                const id = Number(sym.dataset.id);
                flash(id);
                checkInput(id);
            });
        });

        function checkInput(id) {
            const index = userInput.length;

            if (id === sequence[index]) {
                userInput.push(id);
                progressBox.children[index].classList.add('active');

                if (userInput.length === length) {
                    win();
                }
            } else {
                fail();
            }
        }

        function fail() {
            errorSound.play().catch(()=>{});
            game.classList.add('shake');
            [...progressBox.children].forEach(dot => dot.className = 'dot error');
            
            game.style.pointerEvents = 'none';
            
            setTimeout(() => {
                game.classList.remove('shake');
                initRound(); // Reinicia
            }, 800);
        }

        function win() {
            game.style.pointerEvents = 'none';
            successSound.play().catch(()=>{});
            [...progressBox.children].forEach(dot => dot.className = 'dot success');
            
            localStorage.setItem('digit_2', '3'); // Salva o progresso

            setTimeout(() => {
                game.style.display = 'none';
                finalScreen.style.display = 'flex';
                setTimeout(() => finalScreen.style.opacity = 1, 50);
            }, 1200);
        }

        function next() {
            window.location.href = "index.html"; 
        }
    </script>
</body>
</html>
